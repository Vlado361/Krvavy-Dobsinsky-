<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krvavý Dobšinský - Podcast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Vlastné farby (Custom Colors) - Updated Color Palette */
        :root {
            /* New colors based on user request */
            --color-primary: #8a1c1c; /* Primary Red */
            --color-secondary: #e6d5b8; /* Beige */
            --color-card-bg: #f0e6d2; /* Light Beige */
            --color-dark-text: #333333; /* Dark Gray Text */
            --color-gray-text: #666666; /* Medium Gray Text */
            --color-light-text: #ffffff; /* White Text */

            /* Derived/Adjusted colors */
            --color-primary-hover: #a13d3d; /* Slightly lighter primary red for hover */
            --color-primary-active: #7a1010; /* Slightly darker primary red for active */
            --color-placeholder-bg: rgba(138, 28, 28, 0.5); /* Semi-transparent primary red for placeholders */
            --color-button-bg: rgba(51, 51, 51, 0.1); /* Light background for standard buttons (based on dark text) */
            --color-button-bg-hover: rgba(51, 51, 51, 0.2); /* Darker background for standard button hover */
            --color-input-border: rgba(51, 51, 51, 0.2); /* Subtle border for form inputs (based on dark text) */
            --color-input-bg: rgba(240, 230, 210, 0.3); /* Very light background for form inputs (based on card bg) */
            --color-focus-ring-primary: rgba(138, 28, 28, 0.5); /* Primary red focus ring, slightly more visible */
            --color-focus-ring-white: rgba(255, 255, 255, 0.7);
            --color-footer-bg: #333333; /* Footer background (using dark text color) */
            --color-accent: var(--color-primary); /* Use primary red as the main accent color (replaces gold) */
        }

        /* Apply custom colors using utility classes (optional but can be helpful) */
        .bg-primary { background-color: var(--color-primary); }
        .text-primary { color: var(--color-primary); }
        .border-primary { border-color: var(--color-primary); }
        .fill-primary { fill: var(--color-primary); }

        .bg-secondary { background-color: var(--color-secondary); }
        .text-secondary { color: var(--color-secondary); }

        .bg-card { background-color: var(--color-card-bg); }

        .text-dark { color: var(--color-dark-text); }
        .bg-dark { background-color: var(--color-dark-text); } /* Note: using dark text color as background */

        .text-gray { color: var(--color-gray-text); }
        .text-light { color: var(--color-light-text); }

        .bg-footer { background-color: var(--color-footer-bg); }

        /* Základné štýly tela a kontajnera (Basic body and container styles) */
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: var(--color-secondary);
            color: var(--color-dark-text);
        }
        .container {
            flex-grow: 1;
        }

        /* Štýly pre textové elementy & Hover efekty (Styles for text elements & Hover effects) */
        .header-title { /* Now applies to H2 */
            @apply text-5xl sm:text-6xl lg:text-7xl font-bold relative z-10 cursor-pointer;
            transition: color 0.3s ease, text-shadow 0.3s ease;
            /* Slightly stronger shadow for better definition */
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.4);
        }
        .header-title:hover {
             /* Keep hover color distinct (e.g., lighter beige or white) */
             color: var(--color-light-text); /* Changed hover to white for contrast */
             text-shadow: 1px 1px 6px rgba(0, 0, 0, 0.5);
        }

        .header-subtitle {
            @apply text-lg md:text-xl relative z-10 mt-2;
             /* Slightly stronger shadow for better definition */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        .nav-link {
            @apply text-sm cursor-pointer text-dark hover:text-primary transition-colors duration-200;
            transition-property: color, opacity;
        }
        .nav-link:hover {
             color: var(--color-primary);
             opacity: 0.8;
        }

        .section-title {
            @apply text-2xl font-bold;
            transition: color 0.3s ease;
            cursor: pointer;
        }
        .section-title:hover {
            color: var(--color-primary);
        }

        .episode-title { /* Title in main player */
            @apply text-xl font-bold text-primary;
            transition: color 0.3s ease;
            cursor: pointer;
        }
        .episode-title:hover {
            color: var(--color-dark-text);
        }

        .episode-date { @apply text-xs text-gray; }
        .episode-desc { @apply text-sm text-dark; }
        .footer-text { @apply text-xs text-light; }

        /* Specific styles for titles within cards */
        .card-episode-title, .card-text-title {
            @apply text-base font-bold text-primary;
            transition: color 0.3s ease;
            cursor: pointer;
        }
        .card-episode-title:hover, .card-text-title:hover {
             color: var(--color-dark-text);
        }

        .card-episode-desc { @apply text-xs leading-normal text-dark; }
        .card-text-excerpt { @apply text-sm leading-relaxed text-dark; }
        .subscribe-text { @apply text-sm leading-relaxed text-dark; }

        /* Indikátor sekcie (Section indicator) - Vertical primary red line */
        .section-indicator::before {
            content: '';
            display: block;
            width: 4px;
            height: 2.5rem;
            background-color: var(--color-primary);
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
        }
        .section-indicator {
            position: relative;
            padding-left: 1.25rem;
            height: 40px;
            display: flex;
            align-items: center;
        }


        /* Načítavanie (Loading placeholder & Spinner) */
        .loading-placeholder {
            background-color: var(--color-placeholder-bg);
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 5rem;
        }

        /* Loading Spinner Styles */
        .loading-spinner {
            width: 2rem;
            height: 2rem;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }


        /* Audio prehrávač (Audio player) */
        audio {
            width: 100%;
            margin-top: 10px;
            height: 35px;
            filter: contrast(1.1) brightness(1.1);
        }
        audio::-webkit-media-controls-panel {
          background-color: var(--color-card-bg);
          border-radius: 6px;
        }
        audio::-webkit-media-controls-play-button,
        audio::-webkit-media-controls-mute-button {
          color: var(--color-primary);
          background-color: rgba(138, 28, 28, 0.1);
          border-radius: 50%;
        }
        audio::-webkit-media-controls-play-button:hover,
        audio::-webkit-media-controls-mute-button:hover {
           background-color: rgba(138, 28, 28, 0.2);
        }
        audio::-webkit-media-controls-timeline {
           background-color: var(--color-secondary);
           border-radius: 4px;
           border: 1px solid rgba(51, 51, 51, 0.1);
        }
        audio::-webkit-media-controls-current-time-display,
        audio::-webkit-media-controls-time-remaining-display {
           color: var(--color-dark-text);
           text-shadow: none;
        }
        audio::-webkit-media-controls-volume-slider {
           background-color: var(--color-secondary);
           border-radius: 4px;
           border: 1px solid rgba(51, 51, 51, 0.1);
        }


        /* Skrytie/zobrazenie placeholderov a content (Hide/show placeholders and content) */
        .loaded .loading-placeholder { display: none; }
        .loaded .content-placeholder { display: block; }
        .content-placeholder { display: none; }

        /* Placeholder text for empty grids - Now contains spinner */
        #all-episodes-grid:empty::before,
        #texts-grid:empty::before {
           content: 'Načítavam obsah...';
           position: absolute;
           width: 1px; height: 1px; padding: 0; margin: -1px;
           overflow: hidden; clip: rect(0, 0, 0, 0);
           white-space: nowrap; border-width: 0;
        }
         #all-episodes-grid:empty,
         #texts-grid:empty {
           display: flex; justify-content: center; align-items: center;
           min-height: 10rem; padding: 2rem;
         }
         #all-episodes-grid:empty::after,
         #texts-grid:empty::after {
            content: ''; display: block;
            width: 2.5rem; height: 2.5rem;
            border: 5px solid rgba(51, 51, 51, 0.2);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
         }


        /* View visibility */
        .view { display: none; } /* Hide all views by default */
        .view.active { display: block; } /* Show the active view */


        /* Štýl pre tlačidlá (Button styles) */
        .play-button, .read-more-button, .subscribe-button, .show-more-button {
            background-color: var(--color-button-bg);
            border-radius: 0.375rem; height: 35px;
            display: inline-flex; align-items: center; justify-content: center;
            font-size: 0.875rem; font-weight: 700; color: var(--color-dark-text);
            margin-top: 0.5rem; padding: 0 1.5rem; cursor: pointer; border: none;
            min-width: 150px; text-decoration: none;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
        }
        .play-button:hover, .read-more-button:hover, .subscribe-button:hover, .show-more-button:hover {
            background-color: var(--color-button-bg-hover);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: scale(1.05);
        }
        /* Ensure SVGs in buttons have consistent size and margin */
        .subscribe-button svg {
             width: 1.1em; /* Slightly larger for visibility */
             height: 1.1em;
             margin-right: 0.6em;
             fill: currentColor;
        }
        .play-button svg, .read-more-button svg, .show-more-button svg {
            width: 1em; height: 1em; margin-right: 0.5em; fill: currentColor;
        }

        /* --- UPDATED Header Button Styles --- */
        .header-button {
             /* Style similar to .form-button */
             background-color: var(--color-primary);
             color: var(--color-light-text);
             padding: 0.6rem 1.1rem; /* Adjusted padding */
             border-radius: 0.375rem; /* 6px */
             font-size: 0.875rem; /* 14px */
             font-weight: 600; /* Semibold */
             text-decoration: none;
             display: inline-flex;
             align-items: center;
             justify-content: center;
             border: none; /* Removed border */
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15); /* Slightly stronger shadow */
             cursor: pointer;
             transition: all 0.25s ease-out; /* Smooth transition for all properties */
             background-size: 200% auto; /* For gradient hover */
        }
        .header-button:hover {
            /* Gradient shift effect + scale + shadow */
            background-image: linear-gradient(to right, var(--color-primary-hover) 0%, var(--color-primary) 50%, var(--color-primary-hover) 100%);
            background-position: right center; /* Shift gradient on hover */
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .header-button:active {
            /* Darker background and slight shrink on click */
            background-color: var(--color-primary-active);
            background-image: none; /* Remove gradient on active */
            transform: scale(0.98);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        .header-button:focus-visible {
            /* Clear focus ring using primary color */
            outline: none;
            box-shadow: 0 0 0 3px var(--color-focus-ring-primary);
        }
        /* --- End of Updated Header Button Styles --- */


        /* Štýly pre formulár (Form styles) */
        .form-label {
            display: block; margin-bottom: 0.5rem;
            font-size: 0.875rem; color: var(--color-dark-text); font-weight: 600;
        }
        .form-input, .form-textarea {
            width: 100%; padding: 0.75rem;
            border: 1px solid var(--color-input-border); border-radius: 0.375rem;
            background-color: var(--color-input-bg); color: var(--color-dark-text);
            margin-bottom: 1rem; font-size: 0.875rem;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.07);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-input:focus, .form-textarea:focus {
            outline: none; border-color: var(--color-primary);
            box-shadow: 0 0 0 2px var(--color-focus-ring-primary), inset 0 1px 2px rgba(0,0,0,0.07);
        }
        .form-textarea {
            min-height: 150px; resize: vertical;
        }
        .form-button { /* This is the "Odoslať príbeh" button */
            background-color: var(--color-primary); color: var(--color-light-text);
            padding: 0.75rem 1.5rem; border: none; border-radius: 0.375rem;
            font-size: 0.875rem; font-weight: 700; cursor: pointer;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
        }
        .form-button:hover {
            background-color: var(--color-primary-hover);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: scale(1.05);
        }
         .form-button:focus-visible {
             outline: none;
             box-shadow: 0 0 0 3px var(--color-focus-ring-primary);
         }
        .form-note {
            font-size: 0.75rem; color: var(--color-gray-text);
            margin-left: 0.5rem; font-weight: 400;
        }

        /* Štýly pre text v O podcaste (Styles for text in About section) */
        .about-text p {
             margin-bottom: 1rem; line-height: 1.625; color: var(--color-dark-text);
        }
        .about-text::after {
            content: ""; clear: both; display: table;
        }

        /* Card hover effect */
        .hoverable-card {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .hoverable-card:hover {
             transform: translateY(-3px);
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Twinkle animation for stars in header */
        @keyframes twinkle {
          0%, 100% { opacity: 0.2; }
          50% { opacity: 0.6; }
        }
        .animate-twinkle { animation: twinkle 4s linear infinite; }
        .animation-delay-700 { animation-delay: 0.7s; }
        .animation-delay-1400 { animation-delay: 1.4s; }

        /* Modal Styles */
        #simple-modal { background-color: rgba(0, 0, 0, 0.6); }
        #simple-modal > div { background-color: var(--color-card-bg); color: var(--color-dark-text); }
        #simple-modal h3 { color: var(--color-primary); }
        #simple-modal button {
            background-color: var(--color-primary); color: var(--color-light-text);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
         #simple-modal button:hover {
             background-color: var(--color-primary-hover); transform: scale(1.03);
         }

    </style>
</head>
<body class="bg-secondary text-dark">

    <div class="container mx-auto max-w-6xl">

        <header class="relative overflow-hidden bg-gradient-to-b from-[--color-primary] to-[#7a1010] text-secondary text-center py-12 md:py-16 h-auto min-h-[300px] flex flex-col justify-center items-center shadow-lg px-4">
            <div class="absolute inset-0 z-0 pointer-events-none" aria-hidden="true">
                <svg class="absolute top-[15%] left-[10%] w-8 h-8 opacity-30 transform -rotate-12" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                     <circle cx="8" cy="8" r="7.5"/>
                </svg>
                <svg class="absolute bottom-[10%] right-[12%] w-12 h-12 opacity-75 transform rotate-[25deg]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                     <circle cx="10" cy="10" r="7" fill="var(--color-primary)"/>
                     <ellipse cx="10" cy="10" rx="6" ry="3" fill="#FFBF00"/> <ellipse cx="10" cy="10" rx="1.5" ry="2.5" fill="var(--color-dark-text)"/>
                </svg>
                <svg class="absolute top-[20%] right-[15%] w-4 h-4 opacity-40 animate-twinkle" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                     <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                </svg>
                <svg class="absolute bottom-[25%] left-[20%] w-5 h-5 opacity-30 animate-twinkle animation-delay-700" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                     <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                </svg>
                 <svg class="absolute top-[55%] left-[5%] w-3 h-3 opacity-30 transform rotate-[-15deg]" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                     <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                 </svg>
                  <svg class="absolute top-[65%] right-[30%] w-4 h-4 opacity-40 transform rotate-6 animate-twinkle animation-delay-1400" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                     <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                  </svg>
            </div>

            <h2 class="header-title" onclick="showView('home', '#latest')" title="Prejsť na domovskú stránku">Krvavý Dobšinský</h2>
            <p class="header-subtitle">Mrazivé príbehy, ktoré vám nedajú spať.</p>

             <div class="mt-6 flex flex-wrap justify-center items-center gap-4 relative z-10">
                 <a onclick="showView('subscribe')"
                     class="header-button"
                     aria-label="Prejsť na sekciu Odoberať">
                     Odoberať podcast
                 </a>
                 <a onclick="showView('contact')"
                     class="header-button"
                     aria-label="Prejsť na sekciu Kontakt">
                     Kontakt
                 </a>
             </div>
        </header>

        <nav id="main-nav" class="bg-secondary bg-opacity-90 h-[50px] flex items-center justify-center space-x-3 sm:space-x-4 md:space-x-8 lg:space-x-12 sticky top-0 z-20 text-sm shadow-md">
             <a onclick="showView('home', '#latest')" class="nav-link">Najnovšia epizóda</a>
             <a onclick="showView('home', '#all')" class="nav-link">Všetky Epizódy</a>
             <a onclick="showView('about')" class="nav-link">O podcaste</a>
             <a onclick="showView('subscribe')" class="nav-link">Odoberať</a>
             <a onclick="showView('texts')" class="nav-link">Texty</a>
             <a onclick="showView('contact')" class="nav-link">Kontakt</a>
        </nav>

        <main class="px-4 md:px-8 lg:px-12 py-8">

            <div id="home-view" class="view active">
                <section id="latest" class="mb-12 scroll-mt-20">
                    <div class="section-indicator mb-5">
                         <h2 class="section-title">Prehrávač</h2>
                    </div>
                    <article id="latest-episode-card" class="bg-card rounded-lg p-4 md:p-6 flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6 min-h-[220px] shadow-lg overflow-hidden">
                        <div class="w-36 h-36 md:w-[180px] md:h-[180px] rounded-md flex-shrink-0 loading-placeholder">
                             <div class="loading-spinner"></div>
                        </div>
                        <img id="latest-episode-image" src="" alt="Obrázok prehrávanej epizódy" class="w-36 h-36 md:w-[180px] md:h-[180px] rounded-md flex-shrink-0 object-cover content-placeholder shadow-md" onerror="this.onerror=null; this.src='https://placehold.co/180x180/f0e6d2/333333?text=Obrázok\\nChýba'; this.alt='Náhradný obrázok epizódy';">
                        <div class="flex-grow">
                            <h3 id="latest-episode-title" class="episode-title">Načítavam názov...</h3>
                            <p id="latest-episode-date" class="episode-date mb-2">Načítavam dátum...</p>
                            <p id="latest-episode-description" class="episode-desc leading-relaxed mb-4">Načítavam popis...</p>
                            <div class="bg-black bg-opacity-10 rounded-md p-2 flex items-center justify-center space-x-3 h-[35px] loading-placeholder">
                                 <div class="loading-spinner w-5 h-5 border-2"></div>
                            </div>
                            <audio id="latest-episode-audio" controls class="content-placeholder" src="">Váš prehliadač nepodporuje audio element.</audio>
                        </div>
                    </article>
                    <p id="rss-error" class="text-primary mt-4" style="display: none;">Nepodarilo sa načítať RSS feed.</p>
                </section>

                <hr class="border-t border-primary border-opacity-60 my-8 w-3/4 mx-auto">

                <section id="all" class="mb-12 scroll-mt-20">
                     <div class="section-indicator mb-5">
                         <h2 class="section-title">Všetky Epizódy</h2>
                    </div>
                    <div id="all-episodes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                         </div>
                    <div id="show-more-container" class="text-center mt-6" style="display: none;">
                         <button id="show-more-button" class="show-more-button w-full sm:w-auto">
                             Zobraziť viac
                         </button>
                    </div>
                    <p id="all-episodes-error" class="text-primary mt-4" style="display: none;">Nepodarilo sa načítať epizódy.</p>
                </section>

            </div>

            <div id="about-view" class="view">
                 <div class="section-indicator mb-5">
                     <h2 class="section-title">O podcaste</h2>
                 </div>
                 <div class="bg-card rounded-lg p-6 md:p-8 shadow-lg overflow-hidden">
                     <img src="https://i.imgur.com/F9fKCIr.png"
                          alt="Logo podcastu Krvavý Dobšinský"
                          class="w-32 h-32 md:w-40 md:h-40 rounded-md flex-shrink-0 object-cover mb-4 mr-6 md:mr-8 shadow-md float-left"
                          onerror="this.style.display='none'">
                     <div class="about-text text-left">
                         <p>Krvavý Dobšinský je originálny slovenský podcast plný strachu, symboliky a temnej krásy rozprávania. Už niekoľko rokov píšem a nahrávam vlastné strašidelné príbehy, ktoré čerpajú z folklóru, snov, tieňov aj z toho, čo si so sebou nesieme z detstva. Každá epizóda je napísaná autorsky – od prvého slova až po posledný dozvuk.</p>
                         <p>Tento podcast vznikol ako osobný projekt. Bez plánov, bez produkčného tímu, len s túžbou rozprávať. Dnes má viac ako milión vypočutí a tisíce verných fanúšikov, ktorí sa vracajú pre atmosféru, akú inde nenájdu.</p>
                         <p>Čo robí Krvavého Dobšinského výnimočným, je profesionálny zvukový dizajn, ktorý posúva príbehy ďaleko za hranice bežného rozprávania. Namiesto klasickej narácie vytváram akustický svet, kde počuť les, dych, vietor, dvere, ticho – a niekedy aj to, čo by tam byť nemalo.</p>
                         <p>Podcast nesie meno po Pavlovi Dobšinskom, ale jeho tón je iný: temnejší, existenciálnejší, intímnejší. Ak ťa lákajú strašidelné príbehy, slovenské legendy, záhadné zmiznutia a svet, kde sa prelína realita s podvedomím – vitaj.</p>
                         <p>Toto je podcast, ktorý nepočúvaš len ušami. Cítiš ho v tele.</p>
                     </div>
                 </div>
            </div>

            <div id="subscribe-view" class="view">
                 <div class="section-indicator mb-5">
                     <h2 class="section-title">Odoberať</h2>
                 </div>
                 <div class="bg-card rounded-lg p-6 md:p-8 shadow-lg">
                     <p class="subscribe-text mb-4">Nech ti žiadny príbeh neunikne.</p>
                     <p class="subscribe-text mb-4">Nové epizódy vychádzajú väčšinou každú stredu – no niekedy sa ozve aj niečo nečakané.</p>
                     <p class="subscribe-text mb-6">Pridaj si Krvavého Dobšinského medzi obľúbené a buď pri tom, keď sa opäť otvorí brána do tmy.</p>
                     <div class="flex flex-wrap gap-4">
                          <a href="https://open.spotify.com/show/1jpZ723mEpLld7bZeZ2wdE?si=890d6112d6bb4d5c" target="_blank" rel="noopener noreferrer" class="subscribe-button" aria-label="Odoberať na Spotify">
                              <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                                <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0M6.75 11.69c-1.743-.984-4.145-1.255-6.84-.77a.53.53 0 0 1-.243-1.023c3.01-.726 5.796-.39 7.74.855a.53.53 0 1 1-.658.738m1.043-1.647c-2.015-1.22-5.12-1.58-7.53-.9a.65.65 0 0 1-.3-.65.65.65 0 0 1 .65-.533c2.758-.78 6.114-.36 8.31.8a.65.65 0 1 1-.77.983M9.9 6.89c-2.4-1.487-6.518-1.848-8.6-.99a.78.78 0 0 1-.36-.777.78.78 0 0 1 .777-.73c2.38-.9 7.03.493 9.57 2.014a.78.78 0 1 1-.887 1.483"/>
                              </svg>
                              Spotify
                          </a>
                          <a href="https://podcasts.apple.com/sk/podcast/krvav%C3%BD-dob%C5%A1insk%C3%BD/id1608900257" target="_blank" rel="noopener noreferrer" class="subscribe-button" aria-label="Odoberať na Apple Podcasts">
                              <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                                <path d="M8.083 11.043c-1.26.01-2.41-.403-3.358-.963-.9-.533-1.68-1.317-2.314-2.288-.633-.97-.938-2.03-.91-3.068a5.15 5.15 0 0 1 .58-2.46c.51-.81 1.23-1.49 2.04-1.96.81-.47 1.7-.696 2.58-.676 1.01.02 1.95.41 2.75.963.79.55 1.43 1.31 1.89 2.18.46.88.7 1.87.68 2.86-.02 1.12-.43 2.18-1.12 3.06-.69.88-1.6 1.53-2.63 1.88-.18.06-.36.11-.54.15m2.63-6.623c.04-.68-.24-1.33-.67-1.88-.43-.55-.98-.9-1.6-.98-.61-.08-1.26.08-1.82.49-.56.4-.95.98-1.11 1.64-.16.66.04 1.34.49 1.88.45.54 1.08.88 1.78.91.13.01.26.01.39.01.55 0 1.1-.18 1.55-.54.45-.36.75-.85.86-1.41"/>
                                <path d="M7.748 16c1.48 0 2.9-.5 4.03-1.49 1.13-.99 1.93-2.3 2.24-3.78-.03.01-2.13.74-3.95-.81-1.82-1.55-.98-4.34.6-5.8 1.57-1.47 3.85-1.7 5.32-.87a6.9 6.9 0 0 0-3.3-5.18c-1.4-.91-3-1.3-4.6-1.28-3.2.05-6.06 1.93-7.4 4.66-.2.4-.37.83-.5 1.28-.34 1.2-.33 2.47.04 3.68.37 1.21 1.02 2.3 1.9 3.17.88.87 1.95 1.5 3.13 1.82.61.16 1.24.24 1.87.24"/>
                              </svg>
                              Apple Podcasts
                          </a>
                          <a href="https://www.instagram.com/krvavydobsinsky/" target="_blank" rel="noopener noreferrer" class="subscribe-button" aria-label="Sledovať na Instagrame">
                              <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                                <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.917 3.917 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.703.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.297-.048c.852-.04 1.433-.174 1.942-.372.526-.205.972-.478 1.417-.923.445-.444.719-.89.923-1.417.198-.51.333-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.297c-.04-.852-.174-1.433-.372-1.942a3.916 3.916 0 0 0-.923-1.417A3.916 3.916 0 0 0 13.24.42c-.51-.198-1.09-.333-1.942-.372C10.445.01 10.173 0 8 0zm0 1.442c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.233s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.389.046-3.232c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.843-.038 1.096-.047 3.232-.047M8 4.938a3.062 3.062 0 1 0 0 6.125 3.062 3.062 0 0 0 0-6.125zm0 4.688a1.625 1.625 0 1 1 0-3.25 1.625 1.625 0 0 1 0 3.25zm4.938-5.617a.96.96 0 1 0 0-1.92.96.96 0 0 0 0 1.92z"/>
                              </svg>
                              Instagram
                          </a>
                     </div>
                 </div>
            </div>

            <div id="contact-view" class="view">
                 <div class="section-indicator mb-5">
                     <h2 class="section-title">Kontaktujte ma</h2>
                 </div>
                 <div class="bg-card rounded-lg p-6 md:p-8 shadow-lg">
                     <p class="text-dark mb-4 leading-relaxed">Máte príbeh, ktorý vám nedá spávať?</p>
                     <p class="text-dark mb-4 leading-relaxed">Možno ste ho zažili na vlastnej koži. Možno vám ho rozprávala stará mama. Možno sa stal… a možno nie.</p>
                     <p class="text-dark mb-6 leading-relaxed">Ak vo vás niečo zostalo – pocit, spomienka, príbeh – napíšte mi. Občas vyberiem niektorý z nich a spracujem ho do epizódy podcastu.</p>
                     <p class="text-dark mb-8 font-semibold">Nebojte sa – stačia slová. Atmosféru už doladím ja.</p>
                     <form id="contact-form" action="#" method="POST" onsubmit="handleContactFormSubmit(event)">
                         <div class="mb-4">
                             <label for="name" class="form-label">Vaše meno alebo prezývka <span class="form-note">(nepovinné)</span></label>
                             <input type="text" id="name" name="name" class="form-input" autocomplete="name">
                         </div>
                         <div class="mb-4">
                             <label for="email" class="form-label">E-mail <span class="form-note">(nepovinné, ak chcete, aby som sa ozval)</span></label>
                             <input type="email" id="email" name="email" class="form-input" autocomplete="email">
                         </div>
                         <div class="mb-4">
                             <label for="story-title" class="form-label">Názov príbehu <span class="form-note">(nepovinné)</span></label>
                             <input type="text" id="story-title" name="story-title" class="form-input">
                         </div>
                         <div class="mb-6">
                             <label for="story" class="form-label">Váš príbeh <span class="text-primary">*</span></label>
                             <textarea id="story" name="story" class="form-textarea" required aria-required="true"></textarea>
                         </div>
                         <div>
                             <button type="submit" class="form-button">Odoslať príbeh</button>
                         </div>
                     </form>
                     <p id="form-success-message" class="mt-4 text-green-700 font-semibold" style="display: none;">Ďakujem! Váš príbeh bol úspešne odoslaný (simulácia).</p>
                      <p id="form-error-message" class="mt-4 text-primary font-semibold" style="display: none;">Chyba: Vyplňte prosím pole "Váš príbeh".</p>
                 </div>
            </div>

            <div id="texts-view" class="view">
                 <div class="section-indicator mb-5">
                      <h2 class="section-title">Texty</h2>
                 </div>
                 <p class="text-dark mb-6 leading-relaxed">Tu nájdete prepisy vybraných epizód alebo iné bonusové texty k podcastu Krvavý Dobšinský.</p>
                 <div id="texts-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                      </div>
                 <p id="texts-error" class="text-primary mt-4" style="display: none;">Nepodarilo sa načítať texty.</p>
            </div>

        </main>

        <footer class="bg-footer text-light text-center py-6 mt-auto rounded-t-xl">
            <p class="footer-text mb-2">© 2025 Krvavý Dobšinský. Všetky práva vyhradené.</p>
            <div class="flex justify-center space-x-4">
                 <a href="https://open.spotify.com/show/1jpZ723mEpLld7bZeZ2wdE?si=890d6112d6bb4d5c" target="_blank" rel="noopener noreferrer" class="text-light hover:text-primary transition-colors" aria-label="Odoberať na Spotify">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0M6.75 11.69c-1.743-.984-4.145-1.255-6.84-.77a.53.53 0 0 1-.243-1.023c3.01-.726 5.796-.39 7.74.855a.53.53 0 1 1-.658.738m1.043-1.647c-2.015-1.22-5.12-1.58-7.53-.9a.65.65 0 0 1-.3-.65.65.65 0 0 1 .65-.533c2.758-.78 6.114-.36 8.31.8a.65.65 0 1 1-.77.983M9.9 6.89c-2.4-1.487-6.518-1.848-8.6-.99a.78.78 0 0 1-.36-.777.78.78 0 0 1 .777-.73c2.38-.9 7.03.493 9.57 2.014a.78.78 0 1 1-.887 1.483"/>
                     </svg>
                 </a>
                 <a href="https://podcasts.apple.com/sk/podcast/krvav%C3%BD-dob%C5%A1insk%C3%BD/id1608900257" target="_blank" rel="noopener noreferrer" class="text-light hover:text-primary transition-colors" aria-label="Odoberať na Apple Podcasts">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8.083 11.043c-1.26.01-2.41-.403-3.358-.963-.9-.533-1.68-1.317-2.314-2.288-.633-.97-.938-2.03-.91-3.068a5.15 5.15 0 0 1 .58-2.46c.51-.81 1.23-1.49 2.04-1.96.81-.47 1.7-.696 2.58-.676 1.01.02 1.95.41 2.75.963.79.55 1.43 1.31 1.89 2.18.46.88.7 1.87.68 2.86-.02 1.12-.43 2.18-1.12 3.06-.69.88-1.6 1.53-2.63 1.88-.18.06-.36.11-.54.15m2.63-6.623c.04-.68-.24-1.33-.67-1.88-.43-.55-.98-.9-1.6-.98-.61-.08-1.26.08-1.82.49-.56.4-.95.98-1.11 1.64-.16.66.04 1.34.49 1.88.45.54 1.08.88 1.78.91.13.01.26.01.39.01.55 0 1.1-.18 1.55-.54.45-.36.75-.85.86-1.41"/>
                        <path d="M7.748 16c1.48 0 2.9-.5 4.03-1.49 1.13-.99 1.93-2.3 2.24-3.78-.03.01-2.13.74-3.95-.81-1.82-1.55-.98-4.34.6-5.8 1.57-1.47 3.85-1.7 5.32-.87a6.9 6.9 0 0 0-3.3-5.18c-1.4-.91-3-1.3-4.6-1.28-3.2.05-6.06 1.93-7.4 4.66-.2.4-.37.83-.5 1.28-.34 1.2-.33 2.47.04 3.68.37 1.21 1.02 2.3 1.9 3.17.88.87 1.95 1.5 3.13 1.82.61.16 1.24.24 1.87.24"/>
                     </svg>
                 </a>
                 <a href="https://www.instagram.com/krvavydobsinsky/" target="_blank" rel="noopener noreferrer" class="text-light hover:text-primary transition-colors" aria-label="Sledovať na Instagrame">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.917 3.917 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.703.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.297-.048c.852-.04 1.433-.174 1.942-.372.526-.205.972-.478 1.417-.923.445-.444.719-.89.923-1.417.198-.51.333-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.297c-.04-.852-.174-1.433-.372-1.942a3.916 3.916 0 0 0-.923-1.417A3.916 3.916 0 0 0 13.24.42c-.51-.198-1.09-.333-1.942-.372C10.445.01 10.173 0 8 0zm0 1.442c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.233s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.389.046-3.232c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.843-.038 1.096-.047 3.232-.047M8 4.938a3.062 3.062 0 1 0 0 6.125 3.062 3.062 0 0 0 0-6.125zm0 4.688a1.625 1.625 0 1 1 0-3.25 1.625 1.625 0 0 1 0 3.25zm4.938-5.617a.96.96 0 1 0 0-1.92.96.96 0 0 0 0 1.92z"/>
                     </svg>
                 </a>
            </div>
        </footer>
        </div>

    <script>
        // --- Configuration ---
        const rssFeedUrl = 'https://anchor.fm/s/8db2e1ec/podcast/rss'; // URL for the podcast RSS feed
        const defaultImageUrl = 'https://i.imgur.com/F9fKCIr.png'; // Default image if none found in feed
        const placeholderErrorImageUrl = 'https://placehold.co/180x180/f0e6d2/333333?text=Obrázok%0AChýba'; // Placeholder if image fails
        const maxDescriptionLengthPlayer = 200; // Max characters for description in the main player
        const maxDescriptionLengthGrid = 80; // Max characters for description in episode cards
        const maxExcerptLengthTexts = 120; // Max characters for excerpt in text cards
        const initialEpisodesToShowDesktop = 6; // How many episodes to show initially on larger screens
        const initialEpisodesToShowMobile = 3; // How many episodes to show initially on smaller screens
        const episodeBatchSizeDesktop = 6; // How many more episodes to load at once on larger screens
        const episodeBatchSizeMobile = 3; // How many more episodes to load at once on smaller screens

        // --- Global variables ---
        let allPodcastItems = []; // Array to store all parsed episode items from RSS
        let currentlyDisplayedCount = 0; // Counter for how many episodes are currently shown in the grid

        // --- DOM Element References ---
        const playerSection = document.getElementById('latest');
        const playerCard = document.getElementById('latest-episode-card');
        const playerImage = document.getElementById('latest-episode-image');
        const playerTitle = document.getElementById('latest-episode-title');
        const playerDate = document.getElementById('latest-episode-date');
        const playerDescription = document.getElementById('latest-episode-description');
        const playerAudio = document.getElementById('latest-episode-audio');
        const rssError = document.getElementById('rss-error');
        const allEpisodesGrid = document.getElementById('all-episodes-grid');
        const allEpisodesError = document.getElementById('all-episodes-error');
        const showMoreContainer = document.getElementById('show-more-container');
        const showMoreButton = document.getElementById('show-more-button');
        const textsGrid = document.getElementById('texts-grid');
        const textsError = document.getElementById('texts-error');
        const homeView = document.getElementById('home-view');
        const contactView = document.getElementById('contact-view');
        const aboutView = document.getElementById('about-view');
        const textsView = document.getElementById('texts-view');
        const subscribeView = document.getElementById('subscribe-view');
        const views = document.querySelectorAll('.view'); // Collection of all view divs
        const contactForm = document.getElementById('contact-form');
        const formSuccessMessage = document.getElementById('form-success-message');
        const formErrorMessage = document.getElementById('form-error-message');

        // --- View Management ---
        /**
         * Shows the specified view and hides others. Optionally scrolls to an element within the view.
         * @param {string} viewId - The ID of the view to show (e.g., 'home', 'about').
         * @param {string|null} [scrollToSelector=null] - Optional CSS selector for an element to scroll to.
         */
        function showView(viewId, scrollToSelector = null) {
            console.log(`Switching to view: ${viewId}, scroll target: ${scrollToSelector || 'none'}`);
            // Hide all views
            views.forEach(view => view.classList.remove('active'));
            // Show the target view
            const activeView = document.getElementById(`${viewId}-view`);
            if (activeView) {
                activeView.classList.add('active');
                // Scroll if a selector is provided
                if (scrollToSelector) {
                    const elementToScroll = activeView.querySelector(scrollToSelector);
                    if (elementToScroll) {
                        // Use setTimeout to ensure the view is rendered before scrolling
                        setTimeout(() => elementToScroll.scrollIntoView({ behavior: 'smooth', block: 'start' }), 0);
                    } else {
                        console.warn(`Scroll target '${scrollToSelector}' not found in view '${viewId}'. Scrolling to top.`);
                        setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 0); // Scroll to top as fallback
                    }
                } else {
                    // Scroll to top if no specific element is targeted
                    setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 0);
                }
            } else {
                // Fallback if the view ID is invalid
                console.error(`View '${viewId}-view' not found. Defaulting to home.`);
                homeView.classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // --- Utility Functions ---
        /**
         * Formats a date string into Slovak locale format (DD. Mesiac RRRR).
         * @param {string} dateString - The date string (e.g., from RSS pubDate).
         * @returns {string} Formatted date string or original string if formatting fails.
         */
        function formatSlovakDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) throw new Error("Invalid date string"); // Check for invalid date
                return date.toLocaleDateString('sk-SK', { year: 'numeric', month: 'long', day: 'numeric' });
            } catch (e) {
                console.error("Date formatting error:", dateString, e);
                return dateString; // Return original string on error
            }
        }

        /**
         * Extracts plain text from an HTML string and shortens it to a max length.
         * @param {string} htmlString - The HTML content (e.g., from RSS description).
         * @param {number} [maxLength=100] - The maximum length of the returned text.
         * @returns {string} Shortened plain text.
         */
        function extractAndShortenText(htmlString, maxLength = 100) {
            if (!htmlString) return "";
            // Create a temporary div to parse HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlString;
            // Get text content, trim whitespace
            let text = (tempDiv.textContent || tempDiv.innerText || "").trim();
            // Remove trailing URLs often added by podcast platforms
            text = text.replace(/https?:\/\/[^\s]+$/, '').trim();
            // Shorten text if necessary
            if (text.length > maxLength) {
                // Find the last space before the limit to avoid cutting words
                let lastSpace = text.lastIndexOf(' ', maxLength - 3); // -3 for "..."
                // If no space found or it's too early, just cut at the limit
                if (lastSpace === -1 || lastSpace < maxLength / 2) lastSpace = maxLength - 3;
                return text.substring(0, lastSpace).trim() + '...';
            }
            return text;
        }

        // --- Episode Card Creation ---
        /**
         * Creates an HTML article element representing a single podcast episode card.
         * @param {Element} item - The XML <item> element from the RSS feed.
         * @returns {HTMLElement} The created article element.
         */
        function createEpisodeCard(item) {
            // Extract data from the RSS item, providing defaults
            const title = item.querySelector("title")?.textContent || "Neznáma epizóda";
            const pubDate = item.querySelector("pubDate")?.textContent || "";
            const descriptionHtml = item.querySelector("content\\:encoded")?.textContent || item.querySelector("description")?.textContent || "";
            const audioUrl = item.querySelector("enclosure")?.getAttribute("url") || "";
            // Try getting image from item, then channel, then default
            const imageUrl = item.querySelector("itunes\\:image")?.getAttribute("href")
                             || item.closest('channel')?.querySelector("itunes\\:image")?.getAttribute("href") // Look in parent channel if item lacks image
                             || defaultImageUrl;

            // Create the card element
            const card = document.createElement('article');
            card.dataset.fullDesc = descriptionHtml; // Store full description for later use
            card.className = 'bg-card rounded-lg p-4 sm:p-5 flex flex-col min-h-[220px] shadow-lg hoverable-card'; // Apply styling

            // Set inner HTML using template literal
            card.innerHTML = `
                <h3 class="card-episode-title mb-1">${title}</h3>
                <p class="episode-date mb-2">${formatSlovakDate(pubDate)}</p>
                <p class="card-episode-desc leading-normal mb-3 flex-grow overflow-hidden">
                    ${extractAndShortenText(descriptionHtml, maxDescriptionLengthGrid)}
                </p>
                <button class="play-button mt-auto"
                        data-audio-src="${audioUrl}"
                        data-title="${title.replace(/"/g, '"')}" /* Use HTML entity for quotes in data attribute */
                        data-img-src="${imageUrl}"
                        aria-label="Prehrať epizódu ${title.replace(/"/g, '"')}">
                    <svg viewBox="0 0 24 24" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M8 5v14l11-7z"></path></svg>
                    Prehrať
                </button>`;
            return card;
        }


        // --- Event Handlers ---
        /**
         * Handles clicks on "Play" buttons within episode cards. Updates the main player.
         * @param {Event} event - The click event object.
         */
        function handlePlayButtonClick(event) {
            // Find the closest ancestor button
            const button = event.target.closest('.play-button');
            if (!button) return; // Exit if the click wasn't on a play button or its child

            // Get data from the button's data attributes
            const audioSrc = button.dataset.audioSrc;
            const title = button.dataset.title; // Title has quotes escaped as "
            const imgSrc = button.dataset.imgSrc || defaultImageUrl; // Use default if src is missing

            // Check if audio source exists
            if (!audioSrc) {
                console.error("Audio source missing for this episode.");
                showModal("Chyba prehrávania", "Pre túto epizódu sa nenašiel zvukový súbor.");
                return;
            }

            console.log(`Play clicked: ${title}`);

            // Get full description and date from the parent card
            const parentArticle = button.closest('article');
            const fullDescriptionHtml = parentArticle?.dataset.fullDesc || '';
            const dateText = parentArticle?.querySelector('.episode-date')?.textContent || '';

            // Update the main player elements
            playerTitle.textContent = title || "Neznáma epizóda"; // Use the title directly
            playerDate.textContent = dateText;
            playerDescription.textContent = extractAndShortenText(fullDescriptionHtml, maxDescriptionLengthPlayer) || "Popis nie je k dispozícii.";
            playerImage.src = imgSrc;
            // Set fallback image source on error
            playerImage.onerror = () => { playerImage.src = placeholderErrorImageUrl; playerImage.onerror = null; };

            // Load and play audio
            if (playerAudio.src !== audioSrc) { // Load new audio only if different
                playerAudio.src = audioSrc;
                playerAudio.load(); // Important to load the new source
                playerAudio.play().catch(e => { console.error("Audio playback error:", e); showModal("Chyba prehrávania", `Nepodarilo sa spustiť prehrávanie: ${e.message}`); });
            } else if (playerAudio.paused) { // If same audio, just play if paused
                playerAudio.play().catch(e => { console.error("Audio playback error:", e); showModal("Chyba prehrávania", `Nepodarilo sa spustiť prehrávanie: ${e.message}`); });
            }

            // Show player content, hide placeholders
            playerCard.classList.add('loaded');

            // Scroll the player section into view
            playerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        /**
         * Handles the submission of the contact form (simulated).
         * @param {Event} event - The form submission event.
         */
        function handleContactFormSubmit(event) {
            event.preventDefault(); // Prevent actual form submission
            // Hide previous messages
            formSuccessMessage.style.display = 'none';
            formErrorMessage.style.display = 'none';

            // Basic validation: check if story textarea is filled
            const storyTextarea = document.getElementById('story');
            const storyText = storyTextarea.value.trim();
            if (!storyText) {
                formErrorMessage.textContent = 'Chyba: Pole "Váš príbeh" je povinné.';
                formErrorMessage.style.display = 'block';
                storyTextarea.focus(); // Focus the required field
                return; // Stop submission
            }

            // Log form data (simulation - replace with actual submission logic)
            console.log("Form submitted (simulation):", Object.fromEntries(new FormData(contactForm)));

            // Show success message
            formSuccessMessage.style.display = 'block';
            contactForm.reset(); // Clear the form

            // Hide success message after a delay
            setTimeout(() => { formSuccessMessage.style.display = 'none'; }, 5000);
        }

        /**
         * Handles clicks on the "Show More" button to load more episodes.
         */
        function handleShowMoreClick() {
            // Determine batch size based on screen width
            const isMobile = window.innerWidth < 640; // Tailwind's 'sm' breakpoint
            const currentBatchSize = isMobile ? episodeBatchSizeMobile : episodeBatchSizeDesktop;
            console.log(`Showing next batch of ${currentBatchSize} episodes...`);

            // Calculate the range of items to add
            const currentGridCount = allEpisodesGrid.children.length;
            const startIndex = currentGridCount; // Start from the next item
            const endIndex = startIndex + currentBatchSize; // End before this index

            // Get the next batch of items from the stored array
            const itemsToAppend = allPodcastItems.slice(startIndex, endIndex);

            // Append new cards to the grid
            itemsToAppend.forEach(item => {
                try { allEpisodesGrid.appendChild(createEpisodeCard(item)); }
                catch(e) { console.error("Error creating additional card:", e); } // Log errors during card creation
            });

            // Update the displayed count
            currentlyDisplayedCount = allEpisodesGrid.children.length;
            console.log(`Now displaying ${currentlyDisplayedCount} episodes.`);

            // Hide the "Show More" button if all items are displayed
            if (currentlyDisplayedCount >= allPodcastItems.length) {
                showMoreContainer.style.display = 'none';
                console.log("All episodes displayed.");
            }
        }

        // --- Data Loading ---
        /**
         * Fetches and parses the RSS feed, then populates the player and episode grid.
         */
        function loadRssData() {
            console.log("Loading RSS:", rssFeedUrl);
            fetch(rssFeedUrl)
                .then(response => {
                    // Check for network errors
                    if (!response.ok) throw new Error(`Network error: ${response.statusText} (${response.status})`);
                    return response.text(); // Get response body as text
                })
                .then(str => {
                    // Parse the XML string
                    const parser = new window.DOMParser();
                    const data = parser.parseFromString(str, "text/xml");
                    // Check for XML parsing errors
                    const parseError = data.querySelector("parsererror");
                    if (parseError) throw new Error(`XML Parse Error: ${parseError.textContent}`);
                    console.log("RSS Parsed successfully.");
                    return data; // Return the parsed XML document
                })
                .then(data => {
                    // Extract all <item> elements (episodes)
                    allPodcastItems = Array.from(data.querySelectorAll("item"));
                    if (allPodcastItems.length === 0) throw new Error("No episode items found in the RSS feed.");

                    // --- Populate Player with the latest episode (first item) ---
                    const firstItem = allPodcastItems[0];
                    try {
                        const title = firstItem.querySelector("title")?.textContent || "Neznámy názov";
                        const pubDate = firstItem.querySelector("pubDate")?.textContent || "";
                        const descriptionHtml = firstItem.querySelector("content\\:encoded")?.textContent || firstItem.querySelector("description")?.textContent || "";
                        const audioUrl = firstItem.querySelector("enclosure")?.getAttribute("url") || "";
                        const imageUrl = firstItem.querySelector("itunes\\:image")?.getAttribute("href") || data.querySelector("channel > itunes\\:image")?.getAttribute("href") || defaultImageUrl;

                        // Update player elements
                        playerTitle.textContent = title;
                        playerDate.textContent = formatSlovakDate(pubDate);
                        playerDescription.textContent = extractAndShortenText(descriptionHtml, maxDescriptionLengthPlayer);
                        playerImage.src = imageUrl;
                        playerImage.onerror = () => { playerImage.src = placeholderErrorImageUrl; playerImage.onerror = null; }; // Fallback
                        playerAudio.src = audioUrl;
                        playerCard.classList.add('loaded'); // Show player content
                        rssError.style.display = 'none'; // Hide any previous error
                    } catch (e) {
                        // Handle errors during player population
                        console.error("Error processing latest episode:", e);
                        rssError.textContent = 'Chyba pri spracovaní najnovšej epizódy.';
                        rssError.style.display = 'block';
                        // Show player placeholders with error state
                        playerCard.classList.add('loaded'); // Still mark as loaded to hide spinner
                        playerTitle.textContent = 'Chyba'; playerDate.textContent = '-'; playerDescription.textContent = 'Nepodarilo sa načítať.'; playerImage.src = placeholderErrorImageUrl; playerImage.style.display = 'block'; playerAudio.style.display = 'none';
                    }

                    // --- Populate Initial Episode Grid ---
                    allEpisodesGrid.innerHTML = ''; // Clear previous grid content (if any)
                    const isMobile = window.innerWidth < 640;
                    const numEpisodesToDisplay = isMobile ? initialEpisodesToShowMobile : initialEpisodesToShowDesktop;
                    const initialItems = allPodcastItems.slice(0, numEpisodesToDisplay); // Get the first batch

                    // Create and append cards for the initial batch
                    initialItems.forEach(item => {
                         try { allEpisodesGrid.appendChild(createEpisodeCard(item)); }
                         catch(e) { console.error("Error creating initial card:", e); } // Log errors
                    });
                    currentlyDisplayedCount = allEpisodesGrid.children.length; // Update count
                    console.log(`Initially displaying ${currentlyDisplayedCount} episodes.`);

                    // --- Setup Show More Button ---
                    if (allPodcastItems.length > currentlyDisplayedCount) {
                        showMoreContainer.style.display = 'block'; // Show button if more items exist
                    } else {
                        showMoreContainer.style.display = 'none'; // Hide if all items are shown
                    }

                    // Handle case where cards couldn't be created even if items exist
                    if (allEpisodesGrid.children.length === 0 && allPodcastItems.length > 0) {
                         allEpisodesError.textContent = 'Nepodarilo sa zobraziť epizódy (chyba pri vytváraní kariet).';
                         allEpisodesError.style.display = 'block';
                         showMoreContainer.style.display = 'none'; // Hide button if grid is empty
                    } else {
                         allEpisodesError.style.display = 'none'; // Hide error message if grid populated
                    }
                })
                .catch(error => {
                    // Handle fetch or parsing errors
                    console.error("Failed to load/process RSS feed:", error);
                    const errorMsg = `Chyba načítania podcastu: ${error.message}. Skúste obnoviť stránku.`;
                    // Display error messages in relevant sections
                    rssError.textContent = errorMsg;
                    rssError.style.display = 'block';
                    allEpisodesError.textContent = `Chyba načítania epizód: ${error.message}.`;
                    allEpisodesError.style.display = 'block';
                    // Update player to show error state
                    playerCard.classList.add('loaded'); // Hide spinner
                    playerTitle.textContent = 'Chyba'; playerDate.textContent = '-'; playerDescription.textContent = 'Nepodarilo sa načítať dáta.'; playerImage.src = placeholderErrorImageUrl; playerImage.style.display = 'block'; playerAudio.style.display = 'none';
                    // Clear grid and show error
                    allEpisodesGrid.innerHTML = `<p class="col-span-full text-center text-primary p-4">${allEpisodesError.textContent}</p>`;
                    showMoreContainer.style.display = 'none'; // Hide show more button on error
                });
        }

        /**
         * Loads placeholder data for the "Texts" section.
         * (Replace with actual data fetching if available)
         */
        function loadTextsData() {
            console.log("Loading texts data (using placeholders)...");
            textsGrid.innerHTML = ''; // Clear existing grid
            // Placeholder data (replace with actual data source)
            const placeholderTexts = [
                { title: "Prepis: Zmiznutie v lese", excerpt: "Hlboko v hore sa stratil mladý muž. Nikdy ho nenašli, no miestni hovoria o šepotoch medzi stromami a svetlách, ktoré tam nemajú čo robiť...", link: "#" },
                { title: "Bonus: Pôvod legendy o poludnici", excerpt: "Poludnica, bytosť trestajúca tých, čo nedodržiavajú poludňajší pokoj. Aké sú korene tejto strašidelnej postavy slovanského folklóru?", link: "#" },
                { title: "Prepis: Dom na konci ulice", excerpt: "Opustený dom, ktorý láka deti svojimi tajomstvami. Ale čo ak dom nechce, aby odišli? Príbeh inšpirovaný skutočnými udalosťami.", link: "#" }
            ];

            // Handle empty state
            if (placeholderTexts.length === 0) {
                textsGrid.innerHTML = `<p class="col-span-full text-center text-dark p-4">Momentálne nie sú k dispozícii žiadne texty.</p>`;
                textsError.style.display = 'none';
                return;
            }

            // Create and append cards for placeholder texts
            placeholderTexts.forEach(text => {
                try {
                    const card = document.createElement('article');
                    card.className = 'bg-card rounded-lg p-4 sm:p-5 flex flex-col min-h-[220px] shadow-lg hoverable-card';
                    card.innerHTML = `
                         <h3 class="card-text-title mb-2">${text.title}</h3>
                         <p class="card-text-excerpt leading-normal mb-3 flex-grow overflow-hidden">
                             ${extractAndShortenText(text.excerpt, maxExcerptLengthTexts)}
                         </p>
                         <button class="read-more-button mt-auto"
                                 /* Use showModal for placeholders, replace onclick with actual link/action later */
                                 onclick="showModal('Text ešte nie je dostupný', 'Obsah pre \\'${text.title.replace(/"/g, '"')}\\' bude čoskoro pridaný.')" /* Escaped quotes */
                                 aria-label="Čítať viac o ${text.title.replace(/"/g, '"')}">
                             <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-book-half" viewBox="0 0 16 16" aria-hidden="true">
                                 <path d="M8.5 2.687c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388 1.17.953.712 1.04 1.73.108 2.686-.744.75-1.898 1.134-3.174 1.233C11.253 7.128 10 6.6 8.5 5.66z"/>
                                 <path d="M16 14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V1.5A.5.5 0 0 1 4.5 1H6v10.5A1.5 1.5 0 0 0 7.5 13h7a.5.5 0 0 1 .5.5"/>
                             </svg>
                             Čítať viac
                         </button>`;
                    textsGrid.appendChild(card);
                } catch (e) { console.error("Error creating text card:", e); }
            });
            textsError.style.display = 'none'; // Hide error if placeholders loaded
            console.log(`Populated texts grid with ${textsGrid.children.length} placeholders.`);
        }

        /**
         * Displays a simple modal dialog.
         * @param {string} title - The title of the modal.
         * @param {string} message - The message content of the modal.
         */
        function showModal(title, message) {
            // Remove any existing modal first
            const existingModal = document.getElementById('simple-modal');
            if (existingModal) existingModal.remove();

            // Create modal elements
            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'simple-modal';
            modalOverlay.className = 'fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4'; // Tailwind classes for overlay
            // Accessibility attributes
            modalOverlay.setAttribute('role', 'dialog');
            modalOverlay.setAttribute('aria-modal', 'true');
            modalOverlay.setAttribute('aria-labelledby', 'modal-title');
            modalOverlay.setAttribute('aria-describedby', 'modal-message');

            const modalContent = document.createElement('div');
            modalContent.className = 'bg-card text-dark p-6 rounded-lg shadow-xl max-w-sm w-full'; // Tailwind classes for content box

            const modalTitle = document.createElement('h3');
            modalTitle.id = 'modal-title';
            modalTitle.className = 'text-xl font-bold text-primary mb-3'; // Style title
            modalTitle.textContent = title;

            const modalMessage = document.createElement('p');
            modalMessage.id = 'modal-message';
            modalMessage.className = 'text-sm mb-4'; // Style message
            modalMessage.textContent = message;

            const closeButton = document.createElement('button');
            closeButton.className = 'form-button mt-4 w-full'; // Reuse form button style
            closeButton.textContent = 'Zavrieť';
            closeButton.onclick = () => modalOverlay.remove(); // Close action

            // Assemble modal
            modalContent.appendChild(modalTitle);
            modalContent.appendChild(modalMessage);
            modalContent.appendChild(closeButton);
            modalOverlay.appendChild(modalContent);

            // Add to body and focus button
            document.body.appendChild(modalOverlay);
            closeButton.focus();

            // Close modal on overlay click
            modalOverlay.addEventListener('click', (event) => { if (event.target === modalOverlay) modalOverlay.remove(); });

            // Close modal on Escape key press
            function handleEscape(event) {
                if (event.key === 'Escape') {
                    modalOverlay.remove();
                    document.removeEventListener('keydown', handleEscape); // Clean up listener
                }
            }
            document.addEventListener('keydown', handleEscape);
        }


        // --- Initialization ---
        // Run functions after the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM fully loaded and parsed. Initializing page functions.");
            // Add event listeners
            allEpisodesGrid.addEventListener('click', handlePlayButtonClick); // Use event delegation for play buttons
            if (showMoreButton) showMoreButton.addEventListener('click', handleShowMoreClick);
            if (contactForm) contactForm.addEventListener('submit', handleContactFormSubmit);

            // Load initial data
            loadRssData();
            loadTextsData(); // Load text placeholders (or real data if implemented)

             // Ensure quotes in data attributes are handled correctly
             document.querySelectorAll('.play-button[data-title], .read-more-button[aria-label*="Čítať viac o"]').forEach(button => {
                 // The " entity should be handled correctly by the browser when reading dataset or attributes.
                 // If issues arise, it might be related to how the onclick handler string is parsed.
                 // Using event listeners instead of inline onclick is generally more robust.
             });

        });

    </script>

</body>
</html>
