import React, { useState, useEffect, useRef, useCallback } from 'react';
// Removed Spotify import, kept others
import { ArrowRight, Play, Mail, Rss, Instagram, Podcast } from 'lucide-react';
// Removed AOS imports:
// import AOS from 'aos';
// import 'aos/dist/aos.css';

// --- Configuration ---
const RSS_FEED_URL = 'https://anchor.fm/s/8db2e1ec/podcast/rss'; // URL RSS feedu
const DEFAULT_IMAGE_URL = 'https://i.imgur.com/F9fKCIr.png'; // Predvolený obrázok
const PLACEHOLDER_IMAGE_URL = (width = 160, height = 160) => `https://placehold.co/${width}x${height}/A88F66/1B1B1B?text=Načítavam...`;
const MAX_DESCRIPTION_LENGTH_PLAYER = 200; // Max description length in the main player
const MAX_DESCRIPTION_LENGTH_GRID = 80; // Max description length in the episode grid
const MAX_EXCERPT_LENGTH_TEXTS = 120; // Max excerpt length in the Texts section
const EPISODES_PER_PAGE = 3; // Number of episodes loaded at once by "Load More"
const AOS_CSS_URL = 'https://unpkg.com/aos@2.3.1/dist/aos.css';
const AOS_JS_URL = 'https://unpkg.com/aos@2.3.1/dist/aos.js';
// Use a different CORS proxy
const CORS_PROXY_URL = 'https://api.allorigins.win/raw?url=';


// --- Helper Functions ---
/**
 * Formats a date string (e.g., from RSS) into Slovak format 'DD. MMMM<x_bin_42>'.
 * @param {string} dateString - The date string to format.
 * @returns {string} - Formatted date or original string on error.
 */
const formatSlovakDate = (dateString) => {
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) throw new Error("Invalid date object");
        return date.toLocaleDateString('sk-SK', { year: 'numeric', month: 'long', day: 'numeric' });
    } catch (e) {
        console.error("Error formatting date:", dateString, e);
        return dateString; // Return original on error
    }
};

/**
 * Extracts plain text from an HTML string, removes trailing URLs, and shortens it.
 * @param {string} htmlString - HTML string (e.g., episode description).
 * @param {number} [maxLength=100] - Maximum length of the resulting text.
 * @returns {string} - Shortened plain text with ellipsis if truncated.
 */
const extractAndShortenText = (htmlString, maxLength = 100) => {
    if (!htmlString) return "";
    try {
        // Use DOMParser for safer HTML parsing
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlString, 'text/html');
        let text = (doc.body.textContent || "").trim();
        // Remove URLs at the end if separated by space or newline
        text = text.replace(/(?:<br\s*\/?>|\n|\s)*https?:\/\/[^\s]+$/i, '').trim();
        return text.length > maxLength ? text.substring(0, maxLength).trim() + '...' : text;
    } catch (e) {
        console.error("Error extracting text from HTML:", e);
        return htmlString.substring(0, maxLength) + (htmlString.length > maxLength ? '...' : ''); // Basic fallback
    }
};

// --- Placeholder Data for Texts Section ---
const placeholderTexts = [
    { id: "text1", title: "Prepis: Zmiznutie v lese", excerpt: "Hlboko v hore sa stratil mladý muž. Nikdy ho nenašli, no miestni hovoria o šepotoch medzi stromami a svetlách, ktoré tam nemajú čo robiť...", link: "#" },
    { id: "text2", title: "Bonus: Pôvod legendy o poludnici", excerpt: "Poludnica, bytosť trestajúca tých, čo nedodržiavajú poludňajší pokoj. Aké sú korene tejto strašidelnej postavy slovanského folklóru?", link: "#" },
    { id: "text3", title: "Prepis: Dom na konci ulice", excerpt: "Opustený dom, ktorý láka deti svojimi tajomstvami. Ale čo ak dom nechce, aby odišli? Príbeh inšpirovaný skutočnými udalosťami.", link: "#" }
];

// --- Reusable Components ---

// Simple Inline SVG for Spotify Icon
const SpotifyIcon = ({ size = 16, className = "" }) => (
    <svg
        xmlns="http://www.w3.org/2000/svg"
        width={size}
        height={size}
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        className={`lucide lucide-spotify ${className}`}
        aria-hidden="true"
    >
        <circle cx="12" cy="12" r="10" />
        <path d="M15.71 12.65c-.14-.16-.4-.23-.64-.15-.48.16-1.1.23-1.89.23-1.26 0-2.21-.31-2.86-.9-.59-.53-.88-1.23-.88-2.1s.29-1.57.88-2.1c.65-.59 1.6-.9 2.86-.9 1.22 0 2.17.35 2.85.98.64.59.96 1.37.96 2.31 0 .9-.24 1.64-.72 2.22M18.79 9.04a5.96 5.96 0 0 0-5.1-1.54c-1.44.2-2.6.78-3.49 1.71s-1.34 2.11-1.34 3.56 1.34 2.63 3.49 3.56 4.6.34 5.1-1.54"/>
    </svg>
);


// Ripple Effect Hook (Simple Implementation)
const useRipple = () => {
    const [ripples, setRipples] = useState([]);

    const addRipple = (event) => {
        // Ensure event and currentTarget exist
        if (!event || !event.currentTarget) return;
        const button = event.currentTarget;
        const rect = button.getBoundingClientRect();
        // Ensure dimensions are valid
        if (!rect || button.clientWidth === 0 || button.clientHeight === 0) return;

        const diameter = Math.max(button.clientWidth, button.clientHeight);
        const radius = diameter / 2;

        const newRipple = {
            id: Date.now(), // Simple unique ID
            x: event.clientX - rect.left - radius,
            y: event.clientY - rect.top - radius,
            size: diameter,
        };

        setRipples(prev => [...prev, newRipple]);

        // Remove ripple after animation (adjust duration if needed)
        setTimeout(() => {
            setRipples(prev => prev.filter(r => r.id !== newRipple.id));
        }, 600); // Matches CSS animation duration
    };


    const RippleContainer = ({ children }) => (
        <>
            {children}
            {ripples.map(ripple => (
                <span
                    key={ripple.id}
                    className="ripple-effect"
                    style={{
                        left: `${ripple.x}px`,
                        top: `${ripple.y}px`,
                        width: `${ripple.size}px`,
                        height: `${ripple.size}px`,
                    }}
                />
            ))}
        </>
    );

    return { addRipple, RippleContainer };
};

// Button Component with Ripple
const RippleButton = ({ children, className, onClick, ...props }) => {
    const { addRipple, RippleContainer } = useRipple();

    const handleClick = (e) => {
        addRipple(e);
        if (onClick) {
            onClick(e);
        }
    };

    return (
        <button
            className={`relative overflow-hidden ${className}`}
            onClick={handleClick}
            {...props}
        >
            <RippleContainer>{children}</RippleContainer>
        </button>
    );
};

// Header Component
const Header = ({ onNavigate }) => (
    <header
        className="relative bg-gradient-to-b from-[#7A1B1A] to-[#5A0000] text-[#F5F5F5] text-center py-16 min-h-[350px] flex flex-col justify-center items-center overflow-hidden"
        data-aos="fade-in" // AOS attribute remains
    >
        {/* SVG Graphics */}
        <svg className="header-graphic header-star fill-white top-8 left-[35%] star-pulse-1 absolute z-1 pointer-events-none opacity-60 transition-opacity duration-400 ease-in-out filter hover:opacity-100 hover:drop-shadow-white w-2.5 h-2.5" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M5 0 L6.5 3.5 L10 5 L6.5 6.5 L5 10 L3.5 6.5 L0 5 L3.5 3.5 Z" /></svg>
         <svg className="header-graphic header-star fill-white top-16 right-[35%] absolute z-1 pointer-events-none opacity-60 transition-opacity duration-400 ease-in-out filter hover:opacity-100 hover:drop-shadow-white w-2.5 h-2.5" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M5 0 L6.5 3.5 L10 5 L6.5 6.5 L5 10 L3.5 6.5 L0 5 L3.5 3.5 Z" /></svg>
        <svg className="header-graphic header-star fill-white top-6 right-[30%] absolute z-1 pointer-events-none opacity-60 transition-opacity duration-400 ease-in-out filter hover:opacity-100 hover:drop-shadow-white" style={{width: '7px', height: '7px', opacity: 0.5}} viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M5 0 L6.5 3.5 L10 5 L6.5 6.5 L5 10 L3.5 6.5 L0 5 L3.5 3.5 Z" /></svg>
        <svg className="header-graphic header-moon fill-white top-10 right-[25%] absolute z-1 pointer-events-none opacity-60 transition-opacity duration-400 ease-in-out filter hover:opacity-90 hover:drop-shadow-white w-10 h-10 animate-[float_8s_ease-in-out_infinite]" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="9" /></svg>
        <svg className="header-graphic header-eye bottom-8 left-[25%] absolute z-1 pointer-events-none opacity-75 transition-opacity duration-400 ease-in-out filter hover:opacity-100 hover:drop-shadow-gold w-[35px] h-auto animate-[pulse-eye_4s_ease-in-out_infinite]" viewBox="0 0 50 25" xmlns="http://www.w3.org/2000/svg">
            <path d="M 0 12.5 C 5 0, 45 0, 50 12.5 C 45 25, 5 25, 0 12.5 Z" className="fill-[#7A1B1A]"/> {/* Use actual color */}
            <ellipse cx="25" cy="12.5" rx="15" ry="10" className="fill-[#E4C266]"/> {/* Use actual color */}
            <path d="M 25 5 L 25 20" stroke="black" strokeWidth="3"/>
        </svg>

        <div className="relative z-10">
            <h1 className="text-4xl font-bold transition-colors duration-300 ease-in-out cursor-default">Krvavý Dobšinský</h1>
            <p className="text-lg mt-2">Mrazivé príbehy, ktoré vám nedajú spať.</p>

            <div className="mt-6 space-x-4">
                <RippleButton
                    onClick={() => onNavigate('home', '#latest')}
                    className="header-button"
                    aria-label="Prejsť na najnovšiu epizódu"
                >
                    Najnovšia epizóda
                </RippleButton>
                <RippleButton
                    onClick={() => onNavigate('contact')}
                    className="header-button"
                    aria-label="Prejsť na kontaktný formulár"
                >
                    Napíš mi
                </RippleButton>
            </div>
        </div>
    </header>
);

// Navigation Component
const Navigation = ({ onNavigate, isSticky }) => {
    const navClass = `bg-[#A88F66] bg-opacity-90 h-auto min-h-[50px] py-2 flex flex-wrap items-center justify-center gap-x-4 gap-y-1 sm:gap-x-6 lg:gap-x-10 sticky top-0 z-20 text-sm rounded-b-lg transition-all duration-300 ease-in-out ${isSticky ? 'bg-opacity-95 shadow-lg backdrop-blur-sm' : ''}`;

    const navLinks = [
        { id: 'home', label: 'Najnovšia epizóda', target: '#latest' },
        { id: 'home', label: 'Všetky Epizódy', target: '#all' },
        { id: 'about', label: 'O podcaste' },
        { id: 'subscribe', label: 'Odoberať' },
        { id: 'texts', label: 'Texty' },
        { id: 'contact', label: 'Kontakt' },
    ];

    return (
        <nav id="main-nav" className={navClass}>
            {navLinks.map(link => (
                <a
                    key={link.label}
                    onClick={(e) => {
                        e.preventDefault();
                        onNavigate(link.id, link.target);
                    }}
                    href={`#${link.id}`} // Keep href for semantics, but prevent default
                    className="nav-link text-[#F5F5F5] hover:text-[#E4C266]"
                    aria-label={`Prejsť na sekciu ${link.label}`}
                >
                    {link.label}
                </a>
            ))}
        </nav>
    );
};

// Section Title Component
const SectionTitle = ({ title }) => (
    <div className="relative pl-5 mb-5 h-[40px] flex items-center section-indicator">
        <h2 className="text-2xl font-bold transition-colors duration-300 ease-in-out cursor-pointer hover:text-[#E4C266]">{title}</h2>
    </div>
);

// Loading Placeholder Component
const LoadingPlaceholder = ({ className = "h-24", text = "Načítavam..." }) => (
    <div className={`loading-placeholder col-span-full flex items-center justify-center text-[#F5F5F5] ${className}`}>
        {text}
    </div>
);

// Audio Player Component (using latest episode state)
const AudioPlayer = ({ episode, isLoading, hasError }) => { // Added hasError prop
    const audioRef = useRef(null);
    const [imageSrc, setImageSrc] = useState(PLACEHOLDER_IMAGE_URL(180, 180));
    const [imageError, setImageError] = useState(false);

    useEffect(() => {
        // Reset image error state when episode changes
        setImageError(false);
        // Set initial image based on loading state
        if (isLoading) {
            setImageSrc(PLACEHOLDER_IMAGE_URL(180, 180));
        } else if (episode?.imageUrl) {
            setImageSrc(episode.imageUrl);
        } else {
            setImageSrc(DEFAULT_IMAGE_URL); // Default if no URL and not loading
        }
    }, [episode?.guid, isLoading]); // Depend on guid and isLoading

    // Update image if URL changes after initial load (and no error occurred)
    useEffect(() => {
        if (!isLoading && episode?.imageUrl && !imageError) {
            setImageSrc(episode.imageUrl);
        } else if (!isLoading && !episode?.imageUrl) {
            // Ensure default is shown if no URL after loading finishes
             setImageSrc(DEFAULT_IMAGE_URL);
        }
    }, [episode?.imageUrl, isLoading, imageError]);


    const handleImageError = () => {
        console.error(`Error loading player image: ${episode?.imageUrl}. Using default.`);
        setImageError(true);
        setImageSrc(DEFAULT_IMAGE_URL);
    };


    return (
        <article
            id="latest-episode-card"
             // Keep 'loaded' class logic simple: remove placeholders when not loading
            className={`bg-[#A88F66] rounded-lg p-6 flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6 min-h-[220px] player-animation ${isLoading ? '' : 'loaded'}`}
            data-aos="fade-up" // AOS attribute
        >
            {/* Image Placeholder/Actual Image */}
            <div className="w-[180px] h-[180px] rounded-md flex-shrink-0 relative group overflow-hidden">
                 {isLoading ? (
                    <LoadingPlaceholder className="w-full h-full rounded-md" text="Obrázok..." />
                 ) : (
                    <img
                        id="latest-episode-image"
                        src={imageSrc}
                        alt={`Obrázok epizódy: ${episode?.title || (hasError ? 'Chyba' : 'Načítavam...')}`}
                        className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                        onError={handleImageError}
                    />
                 )}
                 {!isLoading && <div className="absolute inset-0 bg-gradient-to-t from-[#1B1B1B] via-transparent to-transparent opacity-0 group-hover:opacity-40 transition-opacity duration-300"></div>}
            </div>

            {/* Episode Details & Audio Control */}
            <div className="flex-grow">
                <h3 id="latest-episode-title" className="text-xl font-bold text-[#E4C266] mb-1">
                    {isLoading ? "Načítavam názov..." : (episode?.title || (hasError ? "Chyba načítania" : "Neznáma epizóda"))}
                </h3>
                <p id="latest-episode-date" className="text-xs text-[#9A7A50] mb-2">
                    {isLoading ? "Načítavam dátum..." : (formatSlovakDate(episode?.pubDate || "") || (hasError ? "-" : ""))}
                </p>
                <p id="latest-episode-description" className="text-sm text-[#1B1B1B] leading-relaxed mb-4">
                    {isLoading ? "Načítavam popis..." : (extractAndShortenText(episode?.descriptionHtml || "", MAX_DESCRIPTION_LENGTH_PLAYER) || (hasError ? "Nepodarilo sa načítať popis." : ""))}
                </p>
                {/* Show audio controls only if NOT loading AND there is an audio URL */}
                {!isLoading && episode?.audioUrl ? (
                    <audio
                        id="latest-episode-audio"
                        ref={audioRef}
                        controls
                        className="w-full custom-audio"
                        src={episode.audioUrl}
                        key={episode.guid} // Force re-render when src changes
                        preload="metadata" // Load only metadata initially
                    >
                        Váš prehliadač nepodporuje audio element.
                    </audio>
                ) : !isLoading && hasError ? (
                     <div className="h-[40px] flex items-center justify-center text-sm text-red-700">Prehrávač nie je dostupný.</div>
                ) : (
                    // Show loading placeholder for the player itself if still loading
                    <LoadingPlaceholder className="h-[40px] rounded-md" text="Prehrávač..." />
                )}
            </div>
        </article>
    );
};

// Episode Card Component (for the grid)
const EpisodeCard = ({ episode, onPlay, index }) => {
    const { addRipple, RippleContainer } = useRipple();

    const handlePlayClick = (e) => {
        addRipple(e); // Trigger ripple on the button itself
        onPlay(episode);
    };

    return (
        <article
            className="bg-[#A88F66] rounded-lg p-5 flex flex-col h-[220px] card-hover-effect border border-transparent hover:border-[#E4C266] transition-all duration-300"
            data-aos="fade-up" // AOS attribute
            data-aos-delay={`${index * 50}`}
        >
            <h3 className="text-base font-bold text-[#E4C266] mb-1 card-episode-title">{episode.title}</h3>
            <p className="text-xs text-[#9A7A50] mb-2 episode-date">{formatSlovakDate(episode.pubDate)}</p>
            <p className="text-xs text-[#1B1B1B] leading-normal mb-3 flex-grow overflow-hidden card-episode-desc">
                {extractAndShortenText(episode.descriptionHtml, MAX_DESCRIPTION_LENGTH_GRID)}
            </p>
            {/* Use RippleButton for consistency */}
            {/* Conditionally render play button only if audioUrl exists */}
            {episode.audioUrl && (
                <RippleButton
                    className="play-button mt-auto group"
                    onClick={handlePlayClick} // Use the combined handler
                    aria-label={`Prehrať epizódu ${episode.title}`}
                >
                    <Play size={16} className="fill-current transition-transform duration-300 group-hover:scale-110 mr-2" aria-hidden="true" />
                    <span className="relative">
                        Prehrať
                        <span className="absolute left-0 -bottom-0.5 w-0 h-0.5 bg-[#1B1B1B] group-hover:w-full transition-all duration-300"></span>
                    </span>
                </RippleButton>
            )}
        </article>
    );
};

// Text Card Component
const TextCard = ({ text, index }) => {
     const { addRipple, RippleContainer } = useRipple();

     const handleReadMoreClick = (e) => {
        addRipple(e);
        // Replace alert with actual navigation or modal logic if implemented
        alert(`Funkcia Čítať viac pre text '${text.title}' ešte nie je implementovaná.`);
     };

    return (
        <article
            className="bg-[#A88F66] rounded-lg p-5 flex flex-col h-[220px] card-hover-effect border border-transparent hover:border-[#E4C266] transition-all duration-300"
            data-aos="fade-up" // AOS attribute
            data-aos-delay={`${index * 50}`}
        >
            <h3 className="text-base font-bold text-[#E4C266] mb-2 card-text-title">{text.title}</h3>
            <p className="text-sm text-[#1B1B1B] leading-normal mb-3 flex-grow overflow-hidden card-text-excerpt">
                {extractAndShortenText(text.excerpt, MAX_EXCERPT_LENGTH_TEXTS)}
            </p>
             <RippleButton
                className="read-more-button mt-auto group"
                onClick={handleReadMoreClick}
                aria-label={`Čítať viac o ${text.title}`}
            >
                <span className="relative">
                    Čítať viac
                    <span className="absolute left-0 -bottom-0.5 w-0 h-0.5 bg-[#1B1B1B] group-hover:w-full transition-all duration-300"></span>
                </span>
            </RippleButton>
        </article>
    );
};

// Contact Form Component
const ContactForm = () => {
    const [formData, setFormData] = useState({ name: '', email: '', 'story-title': '', story: '' });
    const [isSubmitting, setIsSubmitting] = useState(false);
    const [submitStatus, setSubmitStatus] = useState({ success: false, error: null, message: '' });
    const formRef = useRef(null);
     const { addRipple, RippleContainer } = useRipple();

    const handleChange = (e) => {
        setFormData({ ...formData, [e.target.name]: e.target.value });
    };

    const handleSubmit = async (event) => {
        event.preventDefault();
        setSubmitStatus({ success: false, error: null, message: '' }); // Reset status

        if (!formData.story.trim()) {
            setSubmitStatus({ success: false, error: true, message: 'Chyba: Pole "Váš príbeh" je povinné.' });
            formRef.current?.querySelector('#story')?.focus();
            return;
        }

        setIsSubmitting(true);

        // --- Netlify Form Submission ---
        const netlifyFormData = new URLSearchParams();
        netlifyFormData.append('form-name', 'podcast-contact'); // Make sure this matches the form's name attribute
        Object.keys(formData).forEach(key => netlifyFormData.append(key, formData[key]));

        try {
            const response = await fetch('/', { // Netlify detects POST requests to the root path
                method: 'POST',
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: netlifyFormData.toString(),
            });

            if (response.ok) {
                setSubmitStatus({ success: true, error: false, message: 'Ďakujem! Váš príbeh bol úspešne odoslaný.' });
                setFormData({ name: '', email: '', 'story-title': '', story: '' }); // Reset form
                formRef.current?.reset(); // Also reset native form state if needed
                 // Hide success message after 5 seconds
                setTimeout(() => setSubmitStatus({ success: false, error: null, message: '' }), 5000);
            } else {
                const errorText = await response.text();
                throw new Error(`Server error (${response.status}): ${errorText || response.statusText}`);
            }
        } catch (error) {
            console.error("Form submission error:", error);
            setSubmitStatus({ success: false, error: true, message: `Chyba: ${error.message}. Skúste to prosím znova neskôr.` });
        } finally {
            setIsSubmitting(false);
        }
    };

     const handleButtonClick = (e) => {
        addRipple(e);
        // The form submission is handled by onSubmit, so no need to call handleSubmit here
    };

    return (
        <form
            ref={formRef}
            id='contact-form'
            name='podcast-contact' // Required for Netlify
            method='POST'
            data-netlify="true" // Required for Netlify JS detection
            data-netlify-honeypot="bot-field" // Optional honeypot
            onSubmit={handleSubmit}
        >
            {/* Hidden input for Netlify */}
            <input type="hidden" name="form-name" value="podcast-contact" />
            {/* Honeypot field */}
            <p className="hidden">
                <label>
                    Don’t fill this out if you’re human: <input name="bot-field" onChange={handleChange} />
                </label>
            </p>

            <div className="mb-4">
                <label htmlFor="name" className="form-label">Vaše meno alebo prezývka <span className="form-note">(nepovinné)</span></label>
                <input type="text" id="name" name="name" value={formData.name} onChange={handleChange} className="form-input" autoComplete="name" />
            </div>
            <div className="mb-4">
                <label htmlFor="email" className="form-label">E-mail <span className="form-note">(nepovinné, ak chcete, aby som sa ozval)</span></label>
                <input type="email" id="email" name="email" value={formData.email} onChange={handleChange} className="form-input" autoComplete="email" />
            </div>
            <div className="mb-4">
                <label htmlFor="story-title" className="form-label">Názov príbehu <span className="form-note">(nepovinné)</span></label>
                <input type="text" id="story-title" name="story-title" value={formData['story-title']} onChange={handleChange} className="form-input" />
            </div>
            <div className="mb-6">
                <label htmlFor="story" className="form-label">Váš príbeh <span className="text-red-600">*</span></label>
                <textarea id="story" name="story" value={formData.story} onChange={handleChange} className="form-textarea" required aria-required="true"></textarea>
            </div>
            <div>
                 <button
                    type="submit"
                    className={`form-button relative overflow-hidden ${isSubmitting ? 'opacity-70 cursor-not-allowed pulse-animation' : ''}`}
                    disabled={isSubmitting}
                    onClick={handleButtonClick} // Add ripple effect on click
                >
                    <RippleContainer>
                        {isSubmitting ? 'Odosielam...' : 'Odoslať príbeh'}
                    </RippleContainer>
                </button>
            </div>

            {/* Status Messages */}
            {submitStatus.message && (
                <p className={`mt-4 font-semibold ${submitStatus.error ? 'text-red-700' : 'text-green-700'}`}>
                    {submitStatus.message}
                </p>
            )}
        </form>
    );
};

// Footer Component
const Footer = ({ onNavigate }) => (
    <footer className="bg-[#1B1B1B] text-[#F5F5F5] text-center py-4 h-[50px] flex items-center justify-center mt-auto shrink-0">
        <p className="text-xs">
            © {new Date().getFullYear()} Krvavý Dobšinský. Všetky práva vyhradené.
            <a
                href="#privacy-policy"
                onClick={(e) => {
                    e.preventDefault();
                    onNavigate('privacy-policy');
                }}
                className="ml-4 text-[#E4C266] hover:text-white hover:underline transition-colors duration-300"
                aria-label="Prejsť na ochranu osobných údajov"
            >
                Ochrana osobných údajov
            </a>
        </p>
    </footer>
);

// --- Main App Component ---
function App() {
    const [episodes, setEpisodes] = useState([]);
    const [latestEpisode, setLatestEpisode] = useState(null);
    const [displayedEpisodesCount, setDisplayedEpisodesCount] = useState(0);
    const [isLoading, setIsLoading] = useState(true); // Tracks overall loading (fetch attempts)
    const [rssError, setRssError] = useState(null); // Specific error for RSS fetching
    const [activeView, setActiveView] = useState('home');
    const [isSticky, setIsSticky] = useState(false);
    const viewRefs = useRef({}); // To store refs for scrolling
    const [aosInitialized, setAosInitialized] = useState(false); // Track AOS initialization

    // --- Effect for loading AOS library and CSS ---
    useEffect(() => {
        // Check if AOS is already loaded (e.g., by a previous render)
        if (window.AOS || document.getElementById('aos-css') || document.getElementById('aos-js')) {
             // If already loaded, ensure it's initialized
             if (!aosInitialized && typeof window.AOS !== 'undefined') {
                 console.log("AOS already loaded, initializing...");
                 window.AOS.init({
                    duration: 600,
                    once: true,
                    offset: 80,
                    delay: 0,
                    easing: 'ease-out-quad',
                 });
                 setAosInitialized(true);
             }
             return; // Don't add scripts again
        }

        console.log("Loading AOS library...");

        // Load CSS
        const link = document.createElement('link');
        link.id = 'aos-css';
        link.rel = 'stylesheet';
        link.href = AOS_CSS_URL;
        document.head.appendChild(link);

        // Load JS
        const script = document.createElement('script');
        script.id = 'aos-js';
        script.src = AOS_JS_URL;
        script.async = true; // Load asynchronously

        // Initialize AOS after the script loads
        script.onload = () => {
            console.log("AOS script loaded, initializing...");
            if (typeof window.AOS !== 'undefined') {
                window.AOS.init({
                    duration: 600,
                    once: true,
                    offset: 80,
                    delay: 0,
                    easing: 'ease-out-quad',
                });
                setAosInitialized(true); // Mark as initialized
            } else {
                console.error("AOS script loaded but window.AOS is not defined.");
            }
        };

         script.onerror = () => {
             console.error("Failed to load AOS script.");
         };

        document.body.appendChild(script);

        // Cleanup function to remove the added elements on component unmount
        return () => {
            const loadedLink = document.getElementById('aos-css');
            if (loadedLink) {
                // console.log("Cleaning up AOS CSS");
                // loadedLink.remove(); // Optional: remove on unmount
            }
            const loadedScript = document.getElementById('aos-js');
            if (loadedScript) {
                 // console.log("Cleaning up AOS JS");
                 // loadedScript.remove(); // Optional: remove on unmount
            }
        };
    }, [aosInitialized]); // Rerun if aosInitialized changes (though it should only run once to load)


    // --- Effect for refreshing AOS on view/data changes ---
    useEffect(() => {
        if (aosInitialized && typeof window.AOS !== 'undefined') {
            // console.log("Refreshing AOS...");
            window.AOS.refresh();
        }
    }, [activeView, episodes, displayedEpisodesCount, aosInitialized]); // Refresh when content changes


    // Sticky Navigation Handler
    useEffect(() => {
        const handleScroll = () => {
            // Adjust the threshold as needed, e.g., based on header height
            const threshold = 200;
            setIsSticky(window.scrollY > threshold);
        };
        window.addEventListener('scroll', handleScroll, { passive: true });
        handleScroll(); // Initial check
        return () => window.removeEventListener('scroll', handleScroll);
    }, []);

    // Fetch and Parse RSS Data
    useEffect(() => {
        const fetchRssData = async (useProxy = false) => {
            const urlToFetch = useProxy
                ? `${CORS_PROXY_URL}${encodeURIComponent(RSS_FEED_URL)}` // Encode the target URL for the proxy
                : RSS_FEED_URL;

            console.log(`Attempting to fetch RSS feed from: ${urlToFetch}`);

            try {
                const response = await fetch(urlToFetch, {
                    // Add headers if required by the proxy, e.g., for allorigins.win
                    // headers: { 'Origin': window.location.origin } // Example, might not be needed
                });

                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.status} ${response.statusText}`);
                }
                const str = await response.text();
                const parser = new window.DOMParser();
                const data = parser.parseFromString(str, "text/xml");

                // Check for parser errors
                 const parserError = data.querySelector("parsererror");
                 if (parserError) {
                     console.error("XML Parsing Error:", parserError.textContent);
                     // Check if it's a CORS proxy error page (simple check)
                     if (useProxy && (str.includes("error") || str.includes("failed") || str.length < 100)) {
                         throw new Error(`Failed to fetch RSS feed via CORS proxy. Proxy Response: ${str.substring(0, 100)}...`);
                     }
                     throw new Error("Failed to parse RSS feed. Invalid XML.");
                 }

                const items = data.querySelectorAll("item");
                if (!items || items.length === 0) throw new Error("No <item> tags found in RSS feed.");

                const parsedEpisodes = Array.from(items).map((item, index) => {
                    const enclosure = item.querySelector("enclosure");
                    const itunesImage = item.querySelector("itunes\\:image") || item.querySelector("image"); // Fallback for image tag
                    const contentEncoded = item.querySelector("content\\:encoded");
                    const description = item.querySelector("description");

                    return {
                        guid: item.querySelector("guid")?.textContent || `episode-${Date.now()}-${index}`, // Unique ID
                        title: item.querySelector("title")?.textContent || `Epizóda ${index + 1}`,
                        pubDate: item.querySelector("pubDate")?.textContent || "",
                        // Prefer content:encoded, fallback to description
                        descriptionHtml: contentEncoded?.textContent || description?.textContent || "",
                        audioUrl: enclosure?.getAttribute("url") || "",
                        imageUrl: itunesImage?.getAttribute("href") || DEFAULT_IMAGE_URL,
                    };
                });

                console.log(`Successfully parsed ${parsedEpisodes.length} episodes.`);
                setEpisodes(parsedEpisodes);
                setLatestEpisode(parsedEpisodes[0] || null); // Set the first episode as the latest
                setDisplayedEpisodesCount(Math.min(EPISODES_PER_PAGE, parsedEpisodes.length)); // Initial display count
                setRssError(null); // Clear any previous errors

            } catch (err) {
                 console.error(`Failed to load or parse RSS feed ${useProxy ? 'via proxy' : 'directly'}:`, err);
                 // If direct fetch failed, try the proxy next
                 if (!useProxy) {
                     console.warn("Direct fetch failed, trying proxy...");
                     // Don't return here, let the finally block handle isLoading
                     await fetchRssData(true); // Call itself again with useProxy = true
                 } else {
                     // If proxy also failed, set the final error message
                     setRssError(`Chyba načítania podcastu: ${err.message}. Skúste obnoviť stránku.`);
                     // Ensure episodes list is empty if fetching failed completely
                     setEpisodes([]);
                     setLatestEpisode(null);
                 }
            }
        };

        // Initial setup before fetching
        setIsLoading(true);
        setRssError(null);
        setEpisodes([]);
        setLatestEpisode(null);
        setDisplayedEpisodesCount(0);

        // Start fetching (try direct first, fallback to proxy)
        fetchRssData(false).finally(() => {
            setIsLoading(false); // Set loading to false after all fetch attempts (direct and proxy) are done
        });

    }, []); // Fetch only once on mount

    // Handle Navigation and Scrolling
    const handleNavigate = useCallback((viewId, scrollToSelector = null) => {
        setActiveView(viewId);
        // Scroll after state update and render
        setTimeout(() => {
            let elementToScroll = null;
            const targetViewElement = viewRefs.current[viewId];

            if (targetViewElement) {
                 if (scrollToSelector) {
                    // Find the element within the specific view
                    elementToScroll = targetViewElement.querySelector(scrollToSelector);
                    if (!elementToScroll) {
                         console.warn(`Selector '${scrollToSelector}' not found in view '${viewId}'. Scrolling to view top.`);
                         elementToScroll = targetViewElement; // Fallback to view top
                    }
                 } else {
                    elementToScroll = targetViewElement; // Scroll to the top of the view section
                 }
            } else if (scrollToSelector) {
                 // Fallback if view ref not found, try document query
                 elementToScroll = document.querySelector(scrollToSelector);
            }


            if (elementToScroll) {
                elementToScroll.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                 console.warn(`Target element or view '${viewId}' not found for scrolling.`);
                 window.scrollTo({ top: 0, behavior: 'smooth' }); // Fallback to top of page
            }
        }, 100); // Small delay to ensure DOM is updated
    }, []);


    // Handle Play Button Click from Grid
    const handlePlayEpisode = useCallback((episode) => {
        setLatestEpisode(episode);
        // Scroll to the player section
        const playerElement = document.getElementById('latest'); // Use the ID of the player section
        if (playerElement) {
            playerElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
         // Optionally auto-play (browser policies might prevent this)
         const audio = document.getElementById('latest-episode-audio');
         if (audio) {
             // Ensure the audio element is ready before playing
             audio.load(); // Make sure the new source is loaded
             audio.play().catch(e => console.log("Autoplay prevented:", e));
         }
    }, []);

    // Load More Episodes Handler
    const loadMoreEpisodes = () => {
        setDisplayedEpisodesCount(prevCount => Math.min(prevCount + EPISODES_PER_PAGE, episodes.length));
    };

    // Assign refs to view containers
    const setViewRef = (viewId) => (el) => {
        viewRefs.current[viewId] = el;
    };

    const { addRipple: addLoadMoreRipple, RippleContainer: LoadMoreRippleContainer } = useRipple();


    return (
        <div className="flex flex-col min-h-screen bg-[#C5B38C] text-[#1B1B1B] font-poppins overflow-x-hidden">
            <div className="container mx-auto max-w-3xl flex-grow flex flex-col w-full"> {/* Increased max-width */}
                <Header onNavigate={handleNavigate} />
                <Navigation onNavigate={handleNavigate} isSticky={isSticky} />

                <main className="px-4 md:px-6 lg:px-8 py-8 flex-grow"> {/* Adjusted padding */}
                    {/* Display Global Loading State (optional, maybe remove if player handles its own) */}
                     {/* {isLoading && (
                        <div className="text-center p-4 text-[#1B1B1B]">Načítavam RSS feed...</div>
                     )} */}
                     {/* Display Global Error State if it occurred */}
                    {rssError && !isLoading && (
                        <p className="text-red-700 p-4 bg-red-100 border border-red-300 rounded-md mb-4">{rssError}</p>
                    )}

                    {/* Render views regardless of loading state, let components handle their loading */}
                    <>
                        {/* Home View */}
                        <div ref={setViewRef('home')} className={`view ${activeView === 'home' ? 'active' : ''}`}>
                            {/* Player Section is always rendered */}
                            <section id="latest" className="mb-12 scroll-mt-20" ref={setViewRef('latest')}>
                                <SectionTitle title="Prehrávač" />
                                {/* AudioPlayer now handles its display based on isLoading and rssError */}
                                <AudioPlayer episode={latestEpisode} isLoading={isLoading} hasError={!!rssError} />
                            </section>

                            {/* Render episode list only if not loading and no error */}
                            {!isLoading && !rssError && (
                                <>
                                    <hr className="border-t border-[#E4C266] border-opacity-60 my-8 w-3/4 mx-auto" />
                                    <section id="all" className="mb-12 scroll-mt-20" ref={setViewRef('all')}>
                                         <SectionTitle title="Všetky Epizódy" />
                                         <div id="all-episodes-grid" className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {episodes.length === 0 && <p className="col-span-full text-center p-4">Nenašli sa žiadne epizódy.</p>}
                                            {episodes.slice(0, displayedEpisodesCount).map((ep, index) => (
                                                <EpisodeCard key={ep.guid} episode={ep} onPlay={handlePlayEpisode} index={index} />
                                            ))}
                                        </div>
                                        {displayedEpisodesCount < episodes.length && (
                                            <div id="load-more-container" className="text-center mt-8">
                                                <button
                                                    id="load-more-episodes"
                                                    className="load-more-button relative overflow-hidden"
                                                    onClick={(e) => { addLoadMoreRipple(e); loadMoreEpisodes(); }}
                                                >
                                                    <LoadMoreRippleContainer>Načítať ďalšie epizódy</LoadMoreRippleContainer>
                                                </button>
                                            </div>
                                        )}
                                    </section>
                                </>
                            )}
                             {/* Show message if loading finished with error and no episodes were loaded */}
                             {!isLoading && rssError && episodes.length === 0 && (
                                 <p className="text-center p-4 text-gray-600">Zoznam epizód sa nepodarilo načítať.</p>
                             )}
                        </div>

                        {/* About View */}
                        <div ref={setViewRef('about')} className={`view ${activeView === 'about' ? 'active' : ''}`}>
                            <SectionTitle title="O podcaste" />
                            <div className="bg-[#A88F66] rounded-lg p-6 md:p-8 flow-root" data-aos="fade-up">
                                 <img src="https://i.imgur.com/F9fKCIr.png"
                                      alt="Logo podcastu Krvavý Dobšinský"
                                      className="w-32 h-32 md:w-40 md:h-40 rounded-md flex-shrink-0 object-cover mb-4 mr-6 shadow-md float-left"
                                      onError={(e) => { e.target.onerror = null; e.target.src=PLACEHOLDER_IMAGE_URL(160,160); e.target.alt='Logo podcastu'; }}/>
                                <div className="about-text text-left text-sm space-y-4 text-[#1B1B1B]">
                                    <p>Krvavý Dobšinský je originálny slovenský podcast plný strachu, symboliky a temnej krásy rozprávania. Už niekoľko rokov píšem a nahrávam vlastné strašidelné príbehy, ktoré čerpajú z folklóru, snov, tieňov aj z toho, čo si so sebou nesieme z detstva. Každá epizóda je napísaná autorsky – od prvého slova až po posledný dozvuk.</p>
                                    <p>Tento podcast vznikol ako osobný projekt. Bez plánov, bez produkčného tímu, len s túžbou rozprávať. Dnes má viac ako milión vypočutí a tisíce verných fanúšikov, ktorí sa vracajú pre atmosféru, akú inde nenájdu.</p>
                                    <p>Čo robí Krvavého Dobšinského výnimočným, je profesionálny zvukový dizajn, ktorý posúva príbehy ďaleko za hranice bežného rozprávania. Namiesto klasickej narácie vytváram akustický svet, kde počuť les, dych, vietor, dvere, ticho – a niekedy aj to, čo by tam byť nemalo.</p>
                                    <p>Podcast nesie meno po Pavlovi Dobšinskom, ale jeho tón je iný: temnejší, existenciálnejší, intímnejší. Ak ťa lákajú strašidelné príbehy, slovenské legendy, záhadné zmiznutia a svet, kde sa prelína realita s podvedomím – vitaj.</p>
                                    <p>Toto je podcast, ktorý nepočúvaš len ušami. Cítiš ho v tele.</p>
                                </div>
                            </div>
                        </div>

                        {/* Subscribe View */}
                         <div ref={setViewRef('subscribe')} className={`view ${activeView === 'subscribe' ? 'active' : ''}`}>
                            <SectionTitle title="Odoberať" />
                            <div className="bg-[#A88F66] rounded-lg p-6 md:p-8" data-aos="fade-up">
                                <p className="subscribe-text text-[#1B1B1B] mb-4">Nech ti žiadny príbeh neunikne.</p>
                                <p className="subscribe-text text-[#1B1B1B] mb-4">Nové epizódy vychádzajú väčšinou každú stredu – no niekedy sa ozve aj niečo nečakané.</p>
                                <p className="subscribe-text text-[#1B1B1B] mb-6">Pridaj si Krvavého Dobšinského medzi obľúbené a buď pri tom, keď sa opäť otvorí brána do tmy.</p>
                                <div className="flex flex-wrap gap-4">
                                     {/* Using RippleButton for subscribe links */}
                                    <a href="https://open.spotify.com/show/YOUR_SPOTIFY_ID" target="_blank" rel="noopener noreferrer" className="subscribe-button no-underline" aria-label="Odoberať na Spotify">
                                        <RippleButton className="w-full h-full flex items-center justify-center">
                                            {/* Use the new SVG component */}
                                            <SpotifyIcon size={16} className="mr-2 stroke-current" /> Spotify
                                        </RippleButton>
                                    </a>
                                    <a href="https://podcasts.apple.com/sk/podcast/krvav%C3%BD-dob%C5%A1insk%C3%BD/id1608900257" target="_blank" rel="noopener noreferrer" className="subscribe-button no-underline" aria-label="Odoberať na Apple Podcasts">
                                         <RippleButton className="w-full h-full flex items-center justify-center">
                                            <Podcast size={16} className="mr-2" /> Apple Podcasts
                                        </RippleButton>
                                    </a>
                                    <a href="https://www.instagram.com/krvavydobsinsky/" target="_blank" rel="noopener noreferrer" className="subscribe-button no-underline" aria-label="Sledovať na Instagrame">
                                         <RippleButton className="w-full h-full flex items-center justify-center">
                                            <Instagram size={16} className="mr-2" /> Instagram
                                        </RippleButton>
                                    </a>
                                    {/* Add RSS feed link */}
                                    <a href={RSS_FEED_URL} target="_blank" rel="noopener noreferrer" className="subscribe-button no-underline" aria-label="Odoberať cez RSS Feed">
                                         <RippleButton className="w-full h-full flex items-center justify-center">
                                            <Rss size={16} className="mr-2" /> RSS Feed
                                        </RippleButton>
                                    </a>
                                </div>
                            </div>
                        </div>


                        {/* Contact View */}
                         <div ref={setViewRef('contact')} className={`view ${activeView === 'contact' ? 'active' : ''}`}>
                            <SectionTitle title="Kontaktujte ma" />
                            <div className="bg-[#A88F66] rounded-lg p-6 md:p-8" data-aos="fade-up">
                                <p className="text-[#1B1B1B] mb-4 leading-relaxed">Máte príbeh, ktorý vám nedá spávať?</p>
                                <p className="text-[#1B1B1B] mb-4 leading-relaxed">Možno ste ho zažili na vlastnej koži. Možno vám ho rozprávala stará mama. Možno sa stal… a možno nie.</p>
                                <p className="text-[#1B1B1B] mb-6 leading-relaxed">Ak vo vás niečo zostalo – pocit, spomienka, príbeh – napíšte mi. Občas vyberiem niektorý z nich a spracujem ho do epizódy podcastu.</p>
                                <p className="text-[#1B1B1B] mb-8 font-semibold">Nebojte sa – stačia slová. Atmosféru už doladím ja.</p>
                                <ContactForm />
                            </div>
                        </div>

                        {/* Texts View */}
                        <div ref={setViewRef('texts')} className={`view ${activeView === 'texts' ? 'active' : ''}`}>
                            <SectionTitle title="Texty" />
                            <p className="text-[#1B1B1B] mb-6 leading-relaxed" data-aos="fade-up">Tu nájdete prepisy vybraných epizód alebo iné bonusové texty k podcastu Krvavý Dobšinský.</p>
                            <div id="texts-grid" className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" data-aos="fade-up" data-aos-delay="100">
                                {/* Render placeholder texts */}
                                {placeholderTexts.length > 0 ? (
                                    placeholderTexts.map((text, index) => (
                                        <TextCard key={text.id} text={text} index={index} />
                                    ))
                                ) : (
                                    <p className="col-span-full text-center p-4">Momentálne nie sú k dispozícii žiadne texty.</p>
                                )}
                                {/* Add loading/error state if fetching texts dynamically */}
                            </div>
                        </div>

                         {/* Privacy Policy View */}
                        <div ref={setViewRef('privacy-policy')} className={`view ${activeView === 'privacy-policy' ? 'active' : ''}`}>
                            <SectionTitle title="Ochrana osobných údajov" />
                            <div className="bg-[#A88F66] rounded-lg p-6 md:p-8" data-aos="fade-up">
                                <div className="privacy-policy-text text-sm space-y-4 text-[#1B1B1B]">
                                    <p>Táto aplikácia („App“) nezhromažďuje, neukladá ani nezdieľa žiadne osobné údaje od používateľov.</p>
                                    <p>Plne rešpektujeme vaše súkromie.</p>
                                    <p>Ak máte akékoľvek otázky alebo obavy týkajúce sa týchto Zásad ochrany osobných údajov, môžete nás kontaktovať na adrese: <a href="mailto:krvavydobsinsky@gmail.com" className="text-[#7A1B1A] hover:underline">krvavydobsinsky@gmail.com</a></p>
                                    <p className='pt-4 text-xs italic'>--- English Version ---</p>
                                    <p>This application (“App”) does not collect, store, or share any personal information from users.</p>
                                    <p>We respect your privacy completely.</p>
                                    <p>If you have any questions or concerns about this Privacy Policy, you can contact us at: <a href="mailto:krvavydobsinsky@gmail.com" className="text-[#7A1B1A] hover:underline">krvavydobsinsky@gmail.com</a></p>
                                </div>
                            </div>
                        </div>
                    </>


                </main>
                <Footer onNavigate={handleNavigate} />
            </div>

             {/* Add Global Styles for elements not easily styled by Tailwind or for overrides */}
             <style jsx global>{`
                /* Globálne nastavenie box-sizing */
                *, *::before, *::after { box-sizing: border-box; }

                html {
                    scroll-behavior: smooth;
                    overflow-x: hidden;
                }
                body {
                     overflow-x: hidden; /* Zabránenie horizontálnemu posúvaniu */
                     background-color: #C5B38C; /* Fallback */
                     font-family: 'Poppins', sans-serif; /* Ensure font is loaded */
                }

                 /* Custom Colors (consider defining these in tailwind.config.js if possible) */
                :root {
                    --color-gold: #E4C266;
                    --color-dark: #1B1B1B;
                    --color-header-text: #F5F5F5;
                    --color-nav-bg: #A88F66; /* bg-[#A88F66] */
                    --color-card-bg: #A88F66; /* bg-[#A88F66] */
                    --color-date-text: #9A7A50; /* text-[#9A7A50] */
                    --color-header-start: #7A1B1A; /* from-[#7A1B1A] */
                    --color-header-end: #5A0000; /* to-[#5A0000] */
                    --color-white: #FFFFFF;
                    --color-ripple: rgba(255, 255, 255, 0.4);
                    --color-footer-link: #E4C266; /* text-[#E4C266] */
                }

                /* Header Button Specific Styles */
                .header-button {
                    background-color: rgba(245, 245, 245, 0.15);
                    color: var(--color-header-text);
                    border: 1px solid rgba(245, 245, 245, 0.3);
                    border-radius: 0.375rem; /* rounded-md */
                    height: 40px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.875rem; /* text-sm */
                    font-weight: 700; /* font-bold */
                    padding: 0 1.5rem; /* px-6 */
                    cursor: pointer;
                    transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
                    text-decoration: none;
                    min-width: 160px;
                     position: relative;
                     overflow: hidden; /* For ripple */
                }
                .header-button:hover {
                    background-color: rgba(245, 245, 245, 0.25);
                    border-color: rgba(245, 245, 245, 0.5);
                    transform: translateY(-2px);
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
                }

                /* Nav Link Specific Styles */
                 .nav-link {
                    font-size: 0.875rem; /* text-sm */
                    cursor: pointer;
                    padding: 0.25rem 0; /* py-1 */
                    position: relative;
                    text-decoration: none;
                    transition: color 0.3s ease;
                }
                .nav-link::after {
                    content: '';
                    position: absolute;
                    width: 0;
                    height: 1px;
                    bottom: -3px;
                    left: 50%;
                    transform: translateX(-50%);
                    background-color: var(--color-gold);
                    transition: width 0.3s ease-in-out;
                }
                .nav-link:hover::after {
                    width: 100%;
                }

                 /* Section Indicator */
                .section-indicator::before {
                    content: '';
                    display: block;
                    width: 4px;
                    height: 2.5rem; /* h-10 */
                    background-color: var(--color-gold);
                    position: absolute;
                    left: 0;
                    top: 50%;
                    transform: translateY(-50%); /* Center vertically */
                }

                /* Loading Placeholder Animation */
                .loading-placeholder {
                    background-color: rgba(122, 27, 26, 0.5); /* bg-[#7A1B1A]/50 */
                    border-radius: 0.375rem; /* rounded-md */
                    animation: pulse-bg 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
                    color: var(--color-header-text);
                    text-align: center;
                    font-size: 0.875rem; /* text-sm */
                }
                @keyframes pulse-bg { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }

                /* View Visibility */
                .view { display: none; }
                .view.active { display: block; }

                 /* General Buttons (Play, Read More, Subscribe, Load More) */
                .play-button, .read-more-button, .subscribe-button, .load-more-button {
                    background-color: rgba(27, 27, 27, 0.1); /* bg-black/10 */
                    border-radius: 0.375rem; /* rounded-md */
                    height: 35px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.875rem; /* text-sm */
                    font-weight: 700; /* font-bold */
                    color: var(--color-dark);
                    /* margin-top: 0.5rem; /* mt-2 - Handled by layout */
                    padding: 0 1.5rem; /* px-6 */
                    cursor: pointer;
                    transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
                    border: none;
                    min-width: 150px;
                    text-decoration: none;
                    position: relative;
                    overflow: hidden; /* For ripple */
                }
                .play-button:hover, .read-more-button:hover, .subscribe-button:hover, .load-more-button:hover {
                    background-color: rgba(27, 27, 27, 0.2); /* bg-black/20 */
                    transform: translateY(-2px);
                    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                }
                .load-more-button {
                    background-color: var(--color-header-start); /* bg-[#7A1B1A] */
                    color: var(--color-header-text);
                    min-width: 200px;
                    height: 40px;
                }
                 .load-more-button:hover {
                    background-color: #9a2b2a; /* Darker red */
                }
                .load-more-button:disabled {
                    background-color: var(--color-nav-bg); /* bg-[#A88F66] */
                    opacity: 0.6;
                    cursor: not-allowed;
                }
                 /* Specific button adjustments if needed */
                 .subscribe-button { min-width: 160px; } /* Ensure consistent width */


                /* Form Styles */
                .form-label { display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--color-dark); }
                .form-input, .form-textarea {
                    width: 100%;
                    padding: 0.75rem; /* p-3 */
                    border: 1px solid rgba(27, 27, 27, 0.2); /* border border-black/20 */
                    border-radius: 0.375rem; /* rounded-md */
                    background-color: rgba(245, 245, 245, 0.1); /* bg-white/10 */
                    color: var(--color-dark);
                    margin-bottom: 1rem; /* mb-4 */
                    font-size: 0.875rem; /* text-sm */
                    transition: border-color 0.3s ease, box-shadow 0.3s ease;
                }
                .form-input:focus, .form-textarea:focus {
                    outline: none;
                    border-color: var(--color-gold); /* focus:border-[#E4C266] */
                    box-shadow: 0 0 0 3px rgba(228, 194, 102, 0.2); /* focus:ring-[#E4C266]/20 */
                }
                .form-textarea { min-height: 150px; resize: vertical; }
                .form-button {
                    background-color: var(--color-header-start); /* bg-[#7A1B1A] */
                    color: var(--color-header-text);
                    padding: 0.75rem 1.5rem; /* py-3 px-6 */
                    border: none;
                    border-radius: 0.375rem; /* rounded-md */
                    font-size: 0.875rem; /* text-sm */
                    font-weight: 700; /* font-bold */
                    cursor: pointer;
                    transition: background-color 0.2s ease, opacity 0.3s ease, transform 0.2s ease;
                     position: relative;
                     overflow: hidden; /* For ripple */
                }
                .form-button:hover:not(:disabled) { background-color: #9a2b2a; transform: translateY(-2px); }
                .form-button:disabled { opacity: 0.7; cursor: not-allowed; }
                .form-note { font-size: 0.75rem; color: var(--color-date-text); margin-left: 0.5rem; }

                 /* Card Hover Effect */
                 .card-hover-effect {
                     /* Base styles handled by Tailwind */
                     transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
                 }
                 .card-hover-effect:hover {
                     transform: translateY(-5px);
                     box-shadow: 0 10px 20px rgba(122, 27, 26, 0.15); /* shadow-lg with custom color */
                     /* border-color handled by hover:border-[#E4C266] */
                 }

                 /* Player Animation Placeholder */
                 .player-animation { /* Placeholder if specific animations are needed */ }
                 @keyframes player-pulse { 0% { box-shadow: 0 0 0 0 rgba(122, 27, 26, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(122, 27, 26, 0); } 100% { box-shadow: 0 0 0 0 rgba(122, 27, 26, 0); } }
                 .pulse-animation { animation: player-pulse 1.5s infinite; }

                 /* Custom Audio Player Styles (Webkit/Mozilla specific) */
                .custom-audio {
                    width: 100%;
                    margin-top: 10px;
                    height: 40px;
                    border-radius: 6px;
                    background-color: rgba(0, 0, 0, 0.1);
                    accent-color: var(--color-gold); /* Modern way to style controls */
                }
                 /* Fine-tune specific controls if accent-color isn't enough */
                .custom-audio::-webkit-media-controls-panel { background-color: transparent; border-radius: 6px; padding: 0 5px; }
                .custom-audio::-webkit-media-controls-play-button { background-color: rgba(228, 194, 102, 0.8); border-radius: 50%; transition: background-color 0.2s ease; margin-right: 8px; }
                .custom-audio::-webkit-media-controls-play-button:hover { background-color: rgba(228, 194, 102, 1); }
                .custom-audio::-webkit-media-controls-current-time-display, .custom-audio::-webkit-media-controls-time-remaining-display { color: var(--color-dark); font-size: 0.75rem; text-shadow: none; }
                .custom-audio::-webkit-media-controls-timeline { background-color: rgba(27, 27, 27, 0.2); border-radius: 4px; height: 6px; margin: 0 5px; }
                /* Thumb styling might need ::-webkit-slider-thumb on the input range if customizing heavily */
                .custom-audio::-webkit-media-controls-volume-slider { background-color: rgba(27, 27, 27, 0.2); border-radius: 4px; height: 6px; }
                 /* Firefox specific styling (less common now) */
                .custom-audio::-moz-range-track { background-color: rgba(27, 27, 27, 0.2); border-radius: 4px; height: 6px; }
                .custom-audio::-moz-range-thumb { width: 12px; height: 12px; background: var(--color-gold); border-radius: 50%; border: none; cursor: pointer; }
                .custom-audio::-moz-range-progress { background-color: var(--color-gold); height: 6px; border-radius: 4px; }

                 /* Header Graphics Styles & Animations */
                .header-graphic { position: absolute; z-index: 1; pointer-events: none; opacity: 0.6; transition: opacity 0.4s ease, filter 0.4s ease, transform 0.4s ease; }
                .header-star { width: 10px; height: 10px; }
                .header-moon { /* width/height set via class */ opacity: 0.5; /* animation set via class */ }
                .header-eye { /* width/height set via class */ opacity: 0.75; /* animation set via class */ transform-origin: center; }
                .star-pulse-1 { animation: pulse-opacity 5s ease-in-out infinite; }
                .star-pulse-2 { animation: pulse-opacity 7s ease-in-out infinite 1s; }
                 /* Header hover effects (apply to header element) */
                 header:hover .header-star { opacity: 1; filter: drop-shadow(0 0 5px white); }
                 header:hover .header-moon { opacity: 0.9; filter: drop-shadow(0 0 8px white); animation-play-state: paused; }
                 header:hover .header-eye { opacity: 1; filter: drop-shadow(0 0 6px var(--color-gold)); animation-play-state: paused; }
                @keyframes pulse-opacity { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.7; } }
                @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
                @keyframes pulse-eye { 0%, 100% { transform: scale(1); opacity: 0.75; } 50% { transform: scale(1.08); opacity: 0.95; } }

                 /* Ripple Effect */
                .ripple-effect {
                    position: absolute;
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple-animation 0.6s linear;
                    background-color: var(--color-ripple);
                    pointer-events: none; /* Prevent interference */
                }
                @keyframes ripple-animation {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }

            `}</style>
        </div>
    );
}

export default App;
